# å‰ç«¯åŠŸèƒ½å¼€å‘æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ–‡æ¡£åŸºäºå¯¹æ¡£æ¡ˆç®¡ç†ç³»ç»Ÿå‰ç«¯é¡¹ç›®çš„å…¨é¢åˆ†æï¼Œæä¾›äº†è¯¦ç»†çš„åŠŸèƒ½å¼€å‘æŒ‡å—ã€‚å½“å‰é¡¹ç›®å·²å®ç°æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ï¼Œä½†åœ¨ç³»ç»Ÿç®¡ç†å’Œé«˜çº§ç‰¹æ€§æ–¹é¢è¿˜æœ‰å¾…å®Œå–„ã€‚

## ğŸ¯ åŠŸèƒ½å®Œæ•´åº¦è¯„ä¼°

- **æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½**ï¼š90% å®Œæˆåº¦ âœ…
- **ç³»ç»Ÿç®¡ç†åŠŸèƒ½**ï¼š40% å®Œæˆåº¦ âš ï¸
- **é«˜çº§åŠŸèƒ½ç‰¹æ€§**ï¼š30% å®Œæˆåº¦ âŒ

## ğŸ”´ é«˜ä¼˜å…ˆçº§å¾…å¼€å‘åŠŸèƒ½

### 1. ç³»ç»Ÿç®¡ç†é¡µé¢æ¨¡å—

#### 1.1 è§’è‰²ç®¡ç†é¡µé¢ (RoleManagement.vue)

**æ–‡ä»¶è·¯å¾„**: `src/pages/system/RoleManagement.vue`

**åŠŸèƒ½éœ€æ±‚**:
- è§’è‰²åˆ—è¡¨å±•ç¤ºï¼ˆè¡¨æ ¼å½¢å¼ï¼‰
- è§’è‰²åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤
- æƒé™åˆ†é…ï¼ˆæ ‘å½¢ç»“æ„é€‰æ‹©ï¼‰
- è§’è‰²çŠ¶æ€ç®¡ç†
- æ‰¹é‡æ“ä½œæ”¯æŒ

**æŠ€æœ¯è¦ç‚¹**:
```vue
<template>
  <div class="role-management">
    <!-- æœç´¢æ  -->
    <div class="search-form">
      <el-form inline>
        <el-form-item label="è§’è‰²åç§°">
          <el-input v-model="searchForm.roleName" placeholder="è¯·è¾“å…¥è§’è‰²åç§°" />
        </el-form-item>
        <el-form-item label="çŠ¶æ€">
          <el-select v-model="searchForm.status" placeholder="è¯·é€‰æ‹©çŠ¶æ€">
            <el-option label="å¯ç”¨" value="active" />
            <el-option label="ç¦ç”¨" value="inactive" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch">æœç´¢</el-button>
          <el-button @click="handleReset">é‡ç½®</el-button>
        </el-form-item>
      </el-form>
    </div>

    <!-- æ“ä½œæ  -->
    <div class="action-bar">
      <el-button type="primary" @click="handleAdd" v-permission="'role:create'">
        æ–°å¢è§’è‰²
      </el-button>
    </div>

    <!-- è§’è‰²è¡¨æ ¼ -->
    <el-table :data="roleList" v-loading="loading">
      <el-table-column prop="roleName" label="è§’è‰²åç§°" />
      <el-table-column prop="roleCode" label="è§’è‰²ç¼–ç " />
      <el-table-column prop="description" label="æè¿°" />
      <el-table-column prop="status" label="çŠ¶æ€">
        <template #default="{ row }">
          <el-tag :type="row.status === 'active' ? 'success' : 'danger'">
            {{ row.status === 'active' ? 'å¯ç”¨' : 'ç¦ç”¨' }}
          </el-tag>
        </template>
      </el-table-column>
      <el-table-column prop="createdAt" label="åˆ›å»ºæ—¶é—´" />
      <el-table-column label="æ“ä½œ" width="200">
        <template #default="{ row }">
          <el-button size="small" @click="handleEdit(row)" v-permission="'role:edit'">
            ç¼–è¾‘
          </el-button>
          <el-button size="small" @click="handleAssignPermissions(row)" v-permission="'role:permission'">
            åˆ†é…æƒé™
          </el-button>
          <el-button size="small" type="danger" @click="handleDelete(row)" v-permission="'role:delete'">
            åˆ é™¤
          </el-button>
        </template>
      </el-table-column>
    </el-table>

    <!-- æƒé™åˆ†é…å¯¹è¯æ¡† -->
    <el-dialog v-model="permissionDialogVisible" title="åˆ†é…æƒé™" width="600px">
      <el-tree
        ref="permissionTreeRef"
        :data="permissionTree"
        :props="{ children: 'children', label: 'name' }"
        show-checkbox
        node-key="id"
        :default-checked-keys="selectedPermissions"
      />
      <template #footer>
        <el-button @click="permissionDialogVisible = false">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="handleSavePermissions">ç¡®å®š</el-button>
      </template>
    </el-dialog>
  </div>
</template>
```

#### 1.2 æƒé™ç®¡ç†é¡µé¢ (PermissionManagement.vue)

**æ–‡ä»¶è·¯å¾„**: `src/pages/system/PermissionManagement.vue`

**åŠŸèƒ½éœ€æ±‚**:
- æƒé™æ ‘å½¢ç»“æ„å±•ç¤º
- æƒé™åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤
- æƒé™å±‚çº§ç®¡ç†
- æƒé™ç±»å‹åˆ†ç±»ï¼ˆèœå•æƒé™ã€æ“ä½œæƒé™ã€æ•°æ®æƒé™ï¼‰

#### 1.3 ç³»ç»Ÿé…ç½®é¡µé¢ (SystemConfig.vue)

**æ–‡ä»¶è·¯å¾„**: `src/pages/system/SystemConfig.vue`

**åŠŸèƒ½éœ€æ±‚**:
- ç³»ç»ŸåŸºç¡€é…ç½®
- ä¸šåŠ¡è§„åˆ™è®¾ç½®
- æ–‡ä»¶ä¸Šä¼ é…ç½®
- é‚®ä»¶é…ç½®
- å®‰å…¨é…ç½®

#### 1.4 æ—¥å¿—ç®¡ç†é¡µé¢ (LogManagement.vue)

**æ–‡ä»¶è·¯å¾„**: `src/pages/system/LogManagement.vue`

**åŠŸèƒ½éœ€æ±‚**:
- æ“ä½œæ—¥å¿—æŸ¥è¯¢
- ç™»å½•æ—¥å¿—æŸ¥è¯¢
- ç³»ç»Ÿæ—¥å¿—æŸ¥è¯¢
- æ—¥å¿—å¯¼å‡ºåŠŸèƒ½
- æ—¥å¿—ç»Ÿè®¡åˆ†æ

### 2. ç³»ç»Ÿç®¡ç†APIæ¨¡å—

#### 2.1 è§’è‰²ç®¡ç†API (role.ts)

**æ–‡ä»¶è·¯å¾„**: `src/api/modules/role.ts`

```typescript
import { request } from "@/utils/request";
import type { Role, RoleCreateForm, RoleUpdateForm, RoleQueryParams } from "@/types/role";

// è·å–è§’è‰²åˆ—è¡¨
export const getRoleList = (params?: RoleQueryParams) => {
  return request.get<ApiResponse<PaginatedResponse<Role>>>("/api/roles", { params });
};

// è·å–è§’è‰²è¯¦æƒ…
export const getRoleDetail = (id: string) => {
  return request.get<ApiResponse<Role>>(`/api/roles/${id}`);
};

// åˆ›å»ºè§’è‰²
export const createRole = (data: RoleCreateForm) => {
  return request.post<ApiResponse<Role>>("/api/roles", data);
};

// æ›´æ–°è§’è‰²
export const updateRole = (id: string, data: RoleUpdateForm) => {
  return request.put<ApiResponse<Role>>(`/api/roles/${id}`, data);
};

// åˆ é™¤è§’è‰²
export const deleteRole = (id: string) => {
  return request.delete<ApiResponse<null>>(`/api/roles/${id}`);
};

// åˆ†é…æƒé™ç»™è§’è‰²
export const assignPermissionsToRole = (roleId: string, permissionIds: string[]) => {
  return request.post<ApiResponse<null>>(`/api/roles/${roleId}/permissions`, {
    permissionIds
  });
};

// è·å–è§’è‰²æƒé™
export const getRolePermissions = (roleId: string) => {
  return request.get<ApiResponse<string[]>>(`/api/roles/${roleId}/permissions`);
};
```

#### 2.2 æƒé™ç®¡ç†API (permission.ts)

**æ–‡ä»¶è·¯å¾„**: `src/api/modules/permission.ts`

```typescript
import { request } from "@/utils/request";
import type { Permission, PermissionTree } from "@/types/permission";

// è·å–æƒé™æ ‘
export const getPermissionTree = () => {
  return request.get<ApiResponse<PermissionTree[]>>("/api/permissions/tree");
};

// è·å–æƒé™åˆ—è¡¨
export const getPermissionList = () => {
  return request.get<ApiResponse<Permission[]>>("/api/permissions");
};

// åˆ›å»ºæƒé™
export const createPermission = (data: Partial<Permission>) => {
  return request.post<ApiResponse<Permission>>("/api/permissions", data);
};

// æ›´æ–°æƒé™
export const updatePermission = (id: string, data: Partial<Permission>) => {
  return request.put<ApiResponse<Permission>>(`/api/permissions/${id}`, data);
};

// åˆ é™¤æƒé™
export const deletePermission = (id: string) => {
  return request.delete<ApiResponse<null>>(`/api/permissions/${id}`);
};
```

#### 2.3 ç³»ç»Ÿé…ç½®API (config.ts)

**æ–‡ä»¶è·¯å¾„**: `src/api/modules/config.ts`

```typescript
import { request } from "@/utils/request";
import type { SystemConfig } from "@/types/config";

// è·å–ç³»ç»Ÿé…ç½®
export const getSystemConfig = () => {
  return request.get<ApiResponse<SystemConfig>>("/api/system/config");
};

// æ›´æ–°ç³»ç»Ÿé…ç½®
export const updateSystemConfig = (data: Partial<SystemConfig>) => {
  return request.put<ApiResponse<SystemConfig>>("/api/system/config", data);
};

// è·å–é…ç½®é¡¹
export const getConfigItem = (key: string) => {
  return request.get<ApiResponse<any>>(`/api/system/config/${key}`);
};

// è®¾ç½®é…ç½®é¡¹
export const setConfigItem = (key: string, value: any) => {
  return request.put<ApiResponse<null>>(`/api/system/config/${key}`, { value });
};
```

#### 2.4 æ—¥å¿—ç®¡ç†API (log.ts)

**æ–‡ä»¶è·¯å¾„**: `src/api/modules/log.ts`

```typescript
import { request } from "@/utils/request";
import type { OperationLog, LoginLog, SystemLog, LogQueryParams } from "@/types/log";

// è·å–æ“ä½œæ—¥å¿—
export const getOperationLogs = (params?: LogQueryParams) => {
  return request.get<ApiResponse<PaginatedResponse<OperationLog>>>("/api/logs/operation", { params });
};

// è·å–ç™»å½•æ—¥å¿—
export const getLoginLogs = (params?: LogQueryParams) => {
  return request.get<ApiResponse<PaginatedResponse<LoginLog>>>("/api/logs/login", { params });
};

// è·å–ç³»ç»Ÿæ—¥å¿—
export const getSystemLogs = (params?: LogQueryParams) => {
  return request.get<ApiResponse<PaginatedResponse<SystemLog>>>("/api/logs/system", { params });
};

// å¯¼å‡ºæ—¥å¿—
export const exportLogs = (type: string, params?: LogQueryParams) => {
  return request.get(`/api/logs/${type}/export`, {
    params,
    responseType: "blob"
  });
};

// æ¸…ç†æ—¥å¿—
export const clearLogs = (type: string, beforeDate: string) => {
  return request.delete(`/api/logs/${type}/clear`, {
    data: { beforeDate }
  });
};
```

## ğŸŸ¡ ä¸­ä¼˜å…ˆçº§å¾…å¼€å‘åŠŸèƒ½

### 3. å®¡è®¡æ—¥å¿—åŠŸèƒ½

#### 3.1 æ—¥å¿—è®°å½•ç»„ä»¶

**æ–‡ä»¶è·¯å¾„**: `src/components/AuditLogger.vue`

**åŠŸèƒ½éœ€æ±‚**:
- è‡ªåŠ¨è®°å½•ç”¨æˆ·æ“ä½œ
- æ•æ„Ÿæ“ä½œç‰¹æ®Šæ ‡è®°
- æ“ä½œç»“æœè®°å½•
- å¼‚å¸¸æ“ä½œå‘Šè­¦

#### 3.2 æ—¥å¿—æŸ¥çœ‹å™¨

**æ–‡ä»¶è·¯å¾„**: `src/components/LogViewer.vue`

**åŠŸèƒ½éœ€æ±‚**:
- å¤šç»´åº¦æ—¥å¿—ç­›é€‰
- æ—¶é—´èŒƒå›´é€‰æ‹©
- æ“ä½œç±»å‹åˆ†ç±»
- ç”¨æˆ·æ“ä½œè½¨è¿¹

### 4. é€šçŸ¥ç³»ç»Ÿ

#### 4.1 é€šçŸ¥ä¸­å¿ƒ

**æ–‡ä»¶è·¯å¾„**: `src/components/NotificationCenter.vue`

**åŠŸèƒ½éœ€æ±‚**:
- å®æ—¶æ¶ˆæ¯æ¨é€
- æ¶ˆæ¯åˆ†ç±»ç®¡ç†
- å·²è¯»/æœªè¯»çŠ¶æ€
- æ¶ˆæ¯å†å²è®°å½•

#### 4.2 é€šçŸ¥è®¾ç½®

**æ–‡ä»¶è·¯å¾„**: `src/pages/user/NotificationSettings.vue`

**åŠŸèƒ½éœ€æ±‚**:
- é€šçŸ¥åå¥½è®¾ç½®
- æ¨é€æ–¹å¼é€‰æ‹©
- æ¶ˆæ¯ç±»å‹è®¢é˜…
- å…æ‰“æ‰°æ—¶é—´è®¾ç½®

### 5. éƒ¨é—¨ç®¡ç†åŠŸèƒ½

#### 5.1 éƒ¨é—¨ç®¡ç†é¡µé¢

**æ–‡ä»¶è·¯å¾„**: `src/pages/system/DepartmentManagement.vue`

**åŠŸèƒ½éœ€æ±‚**:
- éƒ¨é—¨æ ‘å½¢ç»“æ„
- éƒ¨é—¨CRUDæ“ä½œ
- éƒ¨é—¨å±‚çº§è°ƒæ•´
- ç”¨æˆ·éƒ¨é—¨åˆ†é…

## ğŸŸ¢ ä½ä¼˜å…ˆçº§å¾…å¼€å‘åŠŸèƒ½

### 6. é«˜çº§æƒé™åŠŸèƒ½

#### 6.1 æ•°æ®æƒé™é…ç½®

**åŠŸèƒ½éœ€æ±‚**:
- æ•°æ®èŒƒå›´æƒé™
- å­—æ®µçº§æƒé™æ§åˆ¶
- åŠ¨æ€æƒé™è§„åˆ™
- æƒé™ç»§æ‰¿æœºåˆ¶

### 7. ç³»ç»Ÿç›‘æ§åŠŸèƒ½

#### 7.1 ç³»ç»Ÿç›‘æ§é¢æ¿

**æ–‡ä»¶è·¯å¾„**: `src/pages/system/SystemMonitor.vue`

**åŠŸèƒ½éœ€æ±‚**:
- ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
- åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡
- èµ„æºä½¿ç”¨æƒ…å†µ
- ç³»ç»Ÿå¥åº·çŠ¶æ€

### 8. æ•°æ®å¤‡ä»½ä¸æ¢å¤

#### 8.1 å¤‡ä»½ç®¡ç†

**æ–‡ä»¶è·¯å¾„**: `src/pages/system/BackupManagement.vue`

**åŠŸèƒ½éœ€æ±‚**:
- å¤‡ä»½è®¡åˆ’è®¾ç½®
- æ‰‹åŠ¨å¤‡ä»½æ“ä½œ
- å¤‡ä»½æ–‡ä»¶ç®¡ç†
- æ¢å¤æ“ä½œç•Œé¢

## ğŸ“ ç±»å‹å®šä¹‰æ–‡ä»¶

### Role ç±»å‹å®šä¹‰

**æ–‡ä»¶è·¯å¾„**: `src/types/role.ts`

```typescript
export interface Role {
  id: string;
  roleName: string;
  roleCode: string;
  description?: string;
  status: 'active' | 'inactive';
  permissions: string[];
  createdAt: string;
  updatedAt: string;
  createdBy: string;
}

export interface RoleCreateForm {
  roleName: string;
  roleCode: string;
  description?: string;
  status: 'active' | 'inactive';
}

export interface RoleUpdateForm extends Partial<RoleCreateForm> {}

export interface RoleQueryParams {
  roleName?: string;
  status?: string;
  page?: number;
  size?: number;
}
```

### Permission ç±»å‹å®šä¹‰

**æ–‡ä»¶è·¯å¾„**: `src/types/permission.ts`

```typescript
export interface Permission {
  id: string;
  name: string;
  code: string;
  type: 'menu' | 'button' | 'api' | 'data';
  parentId?: string;
  path?: string;
  component?: string;
  icon?: string;
  sort: number;
  status: 'active' | 'inactive';
  description?: string;
  createdAt: string;
  updatedAt: string;
}

export interface PermissionTree extends Permission {
  children?: PermissionTree[];
}
```

### Log ç±»å‹å®šä¹‰

**æ–‡ä»¶è·¯å¾„**: `src/types/log.ts`

```typescript
export interface OperationLog {
  id: string;
  userId: string;
  username: string;
  operation: string;
  module: string;
  method: string;
  params?: string;
  result?: string;
  ip: string;
  userAgent: string;
  status: 'success' | 'failure';
  errorMsg?: string;
  executionTime: number;
  createdAt: string;
}

export interface LoginLog {
  id: string;
  userId: string;
  username: string;
  ip: string;
  location?: string;
  userAgent: string;
  loginType: 'web' | 'mobile' | 'api';
  status: 'success' | 'failure';
  errorMsg?: string;
  createdAt: string;
}

export interface SystemLog {
  id: string;
  level: 'info' | 'warn' | 'error' | 'debug';
  module: string;
  message: string;
  exception?: string;
  createdAt: string;
}

export interface LogQueryParams {
  userId?: string;
  username?: string;
  module?: string;
  status?: string;
  startTime?: string;
  endTime?: string;
  page?: number;
  size?: number;
}
```

## ğŸ› ï¸ å¼€å‘å»ºè®®

### 1. å¼€å‘é¡ºåºå»ºè®®

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šå®Œæˆç³»ç»Ÿç®¡ç†é¡µé¢å’ŒAPI
   - è§’è‰²ç®¡ç†é¡µé¢å’ŒAPI
   - æƒé™ç®¡ç†é¡µé¢å’ŒAPI
   - ç³»ç»Ÿé…ç½®é¡µé¢å’ŒAPI

2. **ç¬¬äºŒé˜¶æ®µ**ï¼šå®Œå–„æ—¥å¿—å’Œé€šçŸ¥åŠŸèƒ½
   - æ—¥å¿—ç®¡ç†é¡µé¢å’ŒAPI
   - é€šçŸ¥ç³»ç»Ÿå®ç°

3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šé«˜çº§åŠŸèƒ½å¼€å‘
   - éƒ¨é—¨ç®¡ç†åŠŸèƒ½
   - é«˜çº§æƒé™åŠŸèƒ½
   - ç³»ç»Ÿç›‘æ§åŠŸèƒ½

### 2. æŠ€æœ¯è¦ç‚¹

- **æƒé™æ§åˆ¶**ï¼šä½¿ç”¨ `v-permission` æŒ‡ä»¤è¿›è¡Œé¡µé¢çº§æƒé™æ§åˆ¶
- **çŠ¶æ€ç®¡ç†**ï¼šä½¿ç”¨ Pinia ç®¡ç†ç³»ç»Ÿé…ç½®å’Œç”¨æˆ·æƒé™çŠ¶æ€
- **API è®¾è®¡**ï¼šéµå¾ª RESTful è§„èŒƒï¼Œç»Ÿä¸€é”™è¯¯å¤„ç†
- **UI ç»„ä»¶**ï¼šåŸºäº Element Plus æ„å»ºï¼Œä¿æŒç•Œé¢ä¸€è‡´æ€§
- **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ TypeScript ç¡®ä¿ç±»å‹å®‰å…¨

### 3. æµ‹è¯•å»ºè®®

- **å•å…ƒæµ‹è¯•**ï¼šä¸ºæ¯ä¸ª API æ¨¡å—ç¼–å†™å•å…ƒæµ‹è¯•
- **é›†æˆæµ‹è¯•**ï¼šæµ‹è¯•é¡µé¢ç»„ä»¶ä¸ API çš„é›†æˆ
- **E2E æµ‹è¯•**ï¼šæµ‹è¯•å®Œæ•´çš„ç”¨æˆ·æ“ä½œæµç¨‹

## ğŸ“ æ€»ç»“

æœ¬å¼€å‘æŒ‡å—æ¶µç›–äº†æ¡£æ¡ˆç®¡ç†ç³»ç»Ÿå‰ç«¯é¡¹ç›®çš„æ‰€æœ‰å¾…å¼€å‘åŠŸèƒ½ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§è¿›è¡Œäº†åˆ†ç±»ï¼Œå¹¶æä¾›äº†è¯¦ç»†çš„å®ç°æ–¹æ¡ˆã€‚å»ºè®®æŒ‰ç…§ä¼˜å…ˆçº§é¡ºåºè¿›è¡Œå¼€å‘ï¼Œç¡®ä¿ç³»ç»ŸåŠŸèƒ½çš„å®Œæ•´æ€§å’Œç¨³å®šæ€§ã€‚

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¯·ä¸¥æ ¼éµå¾ªé¡¹ç›®çš„ç¼–ç è§„èŒƒå’Œè®¾è®¡æ¨¡å¼ï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚