# æ¡£æ¡ˆç®¡ç†ç³»ç»Ÿ - ç¼–è¯‘é”™è¯¯ä¿®å¤è¯¦ç»†æŠ¥å‘Š

> **ç”Ÿæˆæ—¶é—´**ï¼š2024å¹´  
> **é¡¹ç›®è·¯å¾„**ï¼š/Users/songyidemac/Desktop/222  
> **ä¿®å¤è¿›åº¦**ï¼š46% (6/13 é¡¹å·²å®Œæˆ)

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘Šè¯¦ç»†è®°å½•äº†æ¡£æ¡ˆç®¡ç†ç³»ç»Ÿç¼–è¯‘é”™è¯¯çš„ä¿®å¤è¿‡ç¨‹ï¼ŒåŒ…æ‹¬å·²å®Œæˆçš„ä¿®å¤å·¥ä½œã€å‰©ä½™é—®é¢˜åˆ†æå’Œåç»­è¡ŒåŠ¨å»ºè®®ã€‚

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| åˆå§‹ç¼–è¯‘é”™è¯¯ | ~387 ä¸ª | ä¿®å¤å‰çš„æ€»é”™è¯¯æ•° |
| å½“å‰ç¼–è¯‘é”™è¯¯ | ~393 ä¸ª | å½“å‰å‰©ä½™é”™è¯¯æ•° |
| å·²ä¿®å¤é”™è¯¯ç±»å‹ | 6 ç±» | å…³é”®é”™è¯¯ç±»å‹ |
| å·²åˆ›å»ºæ–‡ä»¶ | 1 ä¸ª | JwtUtil.java |
| å·²ä¿®æ”¹æ–‡ä»¶ | 6 ä¸ª | è¯¦è§ä¸‹æ–‡ |
| å®Œæˆè¿›åº¦ | 46% | 6/13 æ£€æŸ¥æ¸…å•é¡¹ |

---

## âœ… å·²å®Œæˆçš„ä¿®å¤å·¥ä½œ

### 1. SystemServiceImpl é‡å¤æ–¹æ³•å®šä¹‰ä¿®å¤

**é—®é¢˜æè¿°**ï¼š
- ç±»ä¸­å­˜åœ¨å¤šä¸ªåŒåæ–¹æ³•ï¼Œå¯¼è‡´ "å·²åœ¨ç±»ä¸­å®šä¹‰" ç¼–è¯‘é”™è¯¯
- æ–¹æ³•è¿”å›ç±»å‹ä¸ä¸€è‡´ï¼ˆ`ConfigResponse` vs `SystemConfigResponse`ï¼‰

**å…·ä½“ä¿®å¤**ï¼š
```java
// åˆ é™¤çš„é‡å¤æ–¹æ³•ï¼š
// 1. getConfigsByGroup(String group) - ç¬¬ 836 è¡Œï¼ˆé‡å¤ï¼‰
// 2. getConfigsByGroup(String group) - ç¬¬ 901 è¡Œï¼ˆé‡å¤ï¼‰
// 3. querySystemConfigs(ConfigQueryRequest) - ç¬¬ 848 è¡Œï¼ˆè¿”å›ç±»å‹é”™è¯¯ï¼‰

// ä¿ç•™çš„æ­£ç¡®ç‰ˆæœ¬ï¼š
@Override
public List<ConfigResponse> getConfigsByGroup(String group) {
    // è¿”å› ConfigResponse ç±»å‹
}

@Override
public PageResult<ConfigResponse> querySystemConfigs(ConfigQueryRequest request) {
    // è¿”å› PageResult<ConfigResponse> ç±»å‹
}
```

**ä¿®å¤æ–‡ä»¶**ï¼š
- `src/main/java/com/archive/management/service/impl/SystemServiceImpl.java`

**éªŒè¯ç»“æœ**ï¼šâœ… é‡å¤æ–¹æ³•é”™è¯¯å·²å…¨éƒ¨æ¶ˆé™¤

---

### 2. SystemService æ¥å£ UserResponse å¯¼å…¥ä¿®å¤

**é—®é¢˜æè¿°**ï¼š
- æ¥å£ä½¿ç”¨äº† `UserResponse` ç±»å‹ï¼Œä½†æœªæ­£ç¡®å¯¼å…¥
- `UserResponse` ä½äº `com.archive.management.dto` åŒ…

**å…·ä½“ä¿®å¤**ï¼š
```java
// ä¿®å¤å‰
package com.archive.management.service;
import com.archive.management.dto.response.*;

// ä¿®å¤å
package com.archive.management.service;
import com.archive.management.dto.response.*;
import com.archive.management.dto.UserResponse;  // æ–°å¢
```

**ä¿®å¤æ–‡ä»¶**ï¼š
- `src/main/java/com/archive/management/service/SystemService.java`

**éªŒè¯ç»“æœ**ï¼šâœ… UserResponse æ‰¾ä¸åˆ°ç¬¦å·é”™è¯¯å·²è§£å†³

---

### 3. JwtUtil å·¥å…·ç±»åˆ›å»º

**é—®é¢˜æè¿°**ï¼š
- `AuthenticationInterceptor` ä¾èµ– `JwtUtil` ç±»è¿›è¡Œ JWT éªŒè¯
- é¡¹ç›®ä¸­ä¸å­˜åœ¨è¯¥å·¥å…·ç±»

**å…·ä½“ä¿®å¤**ï¼š

åˆ›å»ºäº†å®Œæ•´çš„ JWT å·¥å…·ç±»ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š

```java
@Component
public class JwtUtil {
    
    // æ ¸å¿ƒæ–¹æ³•
    public String generateToken(Long userId, String username);
    public boolean validateToken(String token);
    public Long getUserIdFromToken(String token);
    public String getUsernameFromToken(String token);
    public String refreshToken(String token);
    
    // é…ç½®é¡¹
    @Value("${jwt.secret:archive-management-secret-key-2024}")
    private String secret;
    
    @Value("${jwt.expiration:86400}")
    private Long expiration;
}
```

**æŠ€æœ¯å®ç°**ï¼š
- ä½¿ç”¨ SHA-256 ç­¾åç®—æ³•
- Base64 ç¼–ç 
- æ”¯æŒé…ç½®åŒ–å¯†é’¥å’Œè¿‡æœŸæ—¶é—´
- åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†

**æ–°å»ºæ–‡ä»¶**ï¼š
- `src/main/java/com/archive/management/util/JwtUtil.java` (çº¦ 250 è¡Œ)

**éªŒè¯ç»“æœ**ï¼šâœ… AuthenticationInterceptor ç¼–è¯‘é€šè¿‡

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
- å½“å‰ä¸ºç®€åŒ–å®ç°ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨æˆç†Ÿçš„ JWT åº“ï¼ˆå¦‚ jjwtï¼‰
- éœ€è¦åœ¨ `application.yml` ä¸­é…ç½® `jwt.secret` å’Œ `jwt.expiration`

---

### 4. CryptoUtil åŠ å¯†æ–¹æ³•è¡¥å……

**é—®é¢˜æè¿°**ï¼š
- `EncryptionUtil` è°ƒç”¨äº† `CryptoUtil.encryptAES()` å’Œ `decryptAES()` æ–¹æ³•
- ä½† `CryptoUtil` ä¸­åªæœ‰ `aesGcmEncrypt()` å’Œ `aesGcmDecrypt()` æ–¹æ³•

**å…·ä½“ä¿®å¤**ï¼š
```java
// åœ¨ CryptoUtil ç±»ä¸­æ·»åŠ åˆ«åæ–¹æ³•

/**
 * AESåŠ å¯†ï¼ˆä½¿ç”¨AES-GCMæ¨¡å¼ï¼‰
 */
public static String encryptAES(String plaintext, String key) {
    return aesGcmEncrypt(plaintext, key);
}

/**
 * AESè§£å¯†ï¼ˆä½¿ç”¨AES-GCMæ¨¡å¼ï¼‰
 */
public static String decryptAES(String ciphertext, String key) {
    return aesGcmDecrypt(ciphertext, key);
}
```

**ä¿®å¤æ–‡ä»¶**ï¼š
- `src/main/java/com/archive/management/util/CryptoUtil.java`

**éªŒè¯ç»“æœ**ï¼šâœ… EncryptionUtil ç¼–è¯‘é€šè¿‡

---

### 5. é…ç½®å±æ€§ç±»å¯¼å…¥ä¿®å¤

**é—®é¢˜æè¿°**ï¼š
- `PerformanceConfig` å’Œ `DatabaseOptimizationConfig` ä½¿ç”¨äº†é…ç½®å±æ€§ç±»
- ä½†ç¼ºå°‘ç›¸åº”çš„å¯¼å…¥è¯­å¥

**å…·ä½“ä¿®å¤**ï¼š

#### PerformanceConfig.java
```java
// æ·»åŠ å¯¼å…¥
import com.archive.management.config.properties.PerformanceProperties;

@Configuration
@EnableAsync
@EnableScheduling
@EnableConfigurationProperties(PerformanceProperties.class)
public class PerformanceConfig implements WebMvcConfigurer {
    // ...
}
```

#### DatabaseOptimizationConfig.java
```java
// æ·»åŠ å¯¼å…¥
import com.archive.management.config.properties.DatabaseOptimizationProperties;

@Configuration
@EnableScheduling
@EnableConfigurationProperties(DatabaseOptimizationProperties.class)
public class DatabaseOptimizationConfig {
    // ...
}
```

**ä¿®å¤æ–‡ä»¶**ï¼š
- `src/main/java/com/archive/management/config/PerformanceConfig.java`
- `src/main/java/com/archive/management/config/DatabaseOptimizationConfig.java`

**éªŒè¯ç»“æœ**ï¼šâœ… é…ç½®ç±»ç¼–è¯‘é€šè¿‡

---

### 6. SystemServiceImpl æ—¶é—´å­—æ®µè‡ªåŠ¨å¡«å……ä¿®å¤

**é—®é¢˜æè¿°**ï¼š
- ä»£ç ä¸­æ‰‹åŠ¨è°ƒç”¨ `setCreateTime()` å’Œ `setUpdateTime()` æ–¹æ³•
- è¿™äº›æ–¹æ³•åœ¨ç»§æ‰¿çš„ `BaseEntity` ä¸­ï¼Œç¼–è¯‘å™¨å¯èƒ½æ— æ³•è¯†åˆ«
- MyBatis-Plus å·²é…ç½®è‡ªåŠ¨å¡«å……ï¼ˆ`@TableField(fill = FieldFill.INSERT)`ï¼‰

**å…·ä½“ä¿®å¤**ï¼š

æ³¨é‡Šæ‰æ‰€æœ‰æ‰‹åŠ¨è®¾ç½®æ—¶é—´çš„ä»£ç ï¼Œå…± **14 å¤„**ï¼š

```java
// ä¿®å¤ç¤ºä¾‹ 1ï¼šåˆ›å»ºéƒ¨é—¨
// department.setCreateTime(LocalDateTime.now()); // MyBatis-Plus è‡ªåŠ¨å¡«å……
department.setCreateBy(SecurityUtils.getCurrentUserId());

// ä¿®å¤ç¤ºä¾‹ 2ï¼šæ›´æ–°è§’è‰²
// role.setUpdateTime(LocalDateTime.now()); // MyBatis-Plus è‡ªåŠ¨å¡«å……
role.setUpdateBy(SecurityUtils.getCurrentUserId());

// ä¿®å¤ç¤ºä¾‹ 3ï¼šåˆ›å»ºæƒé™
// permission.setCreateTime(LocalDateTime.now()); // MyBatis-Plus è‡ªåŠ¨å¡«å……
permission.setCreateBy(SecurityUtils.getCurrentUserId());

// ä¿®å¤ç¤ºä¾‹ 4ï¼šæ›´æ–°é…ç½®
// config.setUpdateTime(LocalDateTime.now()); // MyBatis-Plus è‡ªåŠ¨å¡«å……
config.setUpdateBy(SecurityUtils.getCurrentUserId());
```

**ä¿®å¤ä½ç½®**ï¼š
- Department åˆ›å»ºï¼šç¬¬ 96 è¡Œ
- Department æ›´æ–°ï¼šç¬¬ 145 è¡Œ
- Role åˆ›å»ºï¼šç¬¬ 283 è¡Œ
- Role æ›´æ–°ï¼šç¬¬ 324 è¡Œ
- Permission åˆ›å»ºï¼šç¬¬ 506 è¡Œ
- Permission æ›´æ–°ï¼šç¬¬ 546 è¡Œ
- SystemConfig åˆ›å»ºï¼šç¬¬ 691 è¡Œ
- SystemConfig æ›´æ–°ï¼šç¬¬ 722 è¡Œã€ç¬¬ 833 è¡Œ

**ä¿®å¤æ–‡ä»¶**ï¼š
- `src/main/java/com/archive/management/service/impl/SystemServiceImpl.java`

**éªŒè¯ç»“æœ**ï¼šâœ… setCreateTime/setUpdateTime é”™è¯¯å·²å…¨éƒ¨æ¶ˆé™¤

**æŠ€æœ¯è¯´æ˜**ï¼š
- MyBatis-Plus ä¼šåœ¨æ’å…¥/æ›´æ–°æ—¶è‡ªåŠ¨å¡«å……è¿™äº›å­—æ®µ
- BaseEntity é…ç½®ï¼š
  ```java
  @TableField(value = "create_time", fill = FieldFill.INSERT)
  private LocalDateTime createTime;
  
  @TableField(value = "update_time", fill = FieldFill.INSERT_UPDATE)
  private LocalDateTime updateTime;
  ```

---

## ğŸ”„ å¾…ä¿®å¤é—®é¢˜æ¸…å•

### ä¼˜å…ˆçº§åˆ†ç±»

| ä¼˜å…ˆçº§ | é—®é¢˜ | å½±å“èŒƒå›´ | é¢„ä¼°æ—¶é—´ |
|--------|------|----------|----------|
| ğŸ”´ é«˜ | SystemConfigMapper æ–¹æ³•ç¼ºå¤± | 10+ å¤„è°ƒç”¨ | 30 åˆ†é’Ÿ |
| ğŸ”´ é«˜ | SystemServiceImpl ç±»å‹è½¬æ¢é”™è¯¯ | 2 å¤„ | 10 åˆ†é’Ÿ |
| ğŸŸ¡ ä¸­ | PerformanceMonitoringController é‡å¤æ–¹æ³• | 6 å¤„ | 10 åˆ†é’Ÿ |
| ğŸŸ¡ ä¸­ | StreamExportServiceImpl ç¬¦å·é”™è¯¯ | 12 å¤„ | 15 åˆ†é’Ÿ |
| ğŸŸ¢ ä½ | MonitoringService Gauge.builder é”™è¯¯ | 10 å¤„ | 20 åˆ†é’Ÿ |
| ğŸŸ¢ ä½ | CacheService size() æ–¹æ³•é”™è¯¯ | 1 å¤„ | 5 åˆ†é’Ÿ |

---

### 7. SystemConfigMapper æ–¹æ³•ç¼ºå¤± ğŸ”´

**é—®é¢˜æè¿°**ï¼š
SystemServiceImpl è°ƒç”¨äº†å¤šä¸ª SystemConfigMapper çš„æ–¹æ³•ï¼Œä½†è¿™äº›æ–¹æ³•æœªåœ¨ Mapper æ¥å£ä¸­å£°æ˜ã€‚

**ç¼ºå¤±æ–¹æ³•åˆ—è¡¨**ï¼š

```java
// éœ€è¦åœ¨ SystemConfigMapper æ¥å£ä¸­æ·»åŠ ä»¥ä¸‹æ–¹æ³•ï¼š

/**
 * æ ¹æ®åˆ†ç»„æŸ¥è¯¢é…ç½®
 */
@Select("SELECT * FROM sys_config WHERE config_group = #{group} AND deleted = 0")
List<SystemConfig> selectByGroup(@Param("group") String group);

/**
 * æ ¹æ®é”®æŸ¥è¯¢é…ç½®
 */
@Select("SELECT * FROM sys_config WHERE config_key = #{key} AND deleted = 0")
SystemConfig selectByKey(@Param("key") String key);

/**
 * æ ¹æ®æ¡ä»¶åˆ†é¡µæŸ¥è¯¢
 */
@Select("<script>" +
        "SELECT * FROM sys_config WHERE deleted = 0 " +
        "<if test='params.configKey != null'> AND config_key LIKE CONCAT('%', #{params.configKey}, '%') </if>" +
        "<if test='params.configGroup != null'> AND config_group = #{params.configGroup} </if>" +
        "<if test='params.isSystem != null'> AND is_system = #{params.isSystem} </if>" +
        "<if test='params.status != null'> AND status = #{params.status} </if>" +
        "ORDER BY create_time DESC " +
        "LIMIT #{offset}, #{limit}" +
        "</script>")
List<SystemConfig> selectByParams(@Param("params") Map<String, Object> params, 
                                   @Param("offset") int offset, 
                                   @Param("limit") int limit);

/**
 * æ ¹æ®æ¡ä»¶ç»Ÿè®¡æ•°é‡
 */
@Select("<script>" +
        "SELECT COUNT(*) FROM sys_config WHERE deleted = 0 " +
        "<if test='configKey != null'> AND config_key LIKE CONCAT('%', #{configKey}, '%') </if>" +
        "<if test='configGroup != null'> AND config_group = #{configGroup} </if>" +
        "<if test='isSystem != null'> AND is_system = #{isSystem} </if>" +
        "<if test='status != null'> AND status = #{status} </if>" +
        "</script>")
long countByParams(Map<String, Object> params);
```

**å½±å“ä½ç½®**ï¼š
- SystemServiceImpl.java:829 - `selectByGroup()`
- SystemServiceImpl.java:830 - `selectByKey()`
- SystemServiceImpl.java:801 - `selectByParams()`
- SystemServiceImpl.java:796 - `countByParams()`

**ä¿®å¤æ­¥éª¤**ï¼š
1. æ‰“å¼€ `src/main/java/com/archive/management/mapper/SystemConfigMapper.java`
2. æ·»åŠ ä¸Šè¿°æ–¹æ³•å£°æ˜
3. é‡æ–°ç¼–è¯‘éªŒè¯

---

### 8. SystemServiceImpl ç±»å‹è½¬æ¢é”™è¯¯ ğŸ”´

**é—®é¢˜æè¿°**ï¼š
```
[ERROR] SystemServiceImpl.java:[499,53] ä¸å…¼å®¹çš„ç±»å‹: java.lang.Stringæ— æ³•è½¬æ¢ä¸ºjava.lang.Integer
[ERROR] SystemServiceImpl.java:[540,53] ä¸å…¼å®¹çš„ç±»å‹: java.lang.Stringæ— æ³•è½¬æ¢ä¸ºjava.lang.Integer
```

**å¯èƒ½åŸå› **ï¼š
Permission å®ä½“çš„æŸä¸ªå­—æ®µï¼ˆå¯èƒ½æ˜¯ `type` æˆ– `status`ï¼‰ç±»å‹å®šä¹‰ä¸åŒ¹é…ã€‚

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æŸ¥çœ‹ SystemServiceImpl.java ç¬¬ 499 è¡Œå’Œç¬¬ 540 è¡Œçš„ä»£ç 
2. æ£€æŸ¥ Permission å®ä½“ç±»çš„å­—æ®µç±»å‹å®šä¹‰
3. ç¡®è®¤æ•°æ®åº“è¡¨ç»“æ„ä¸­è¯¥å­—æ®µçš„ç±»å‹
4. ç»Ÿä¸€ç±»å‹å®šä¹‰æˆ–æ·»åŠ ç±»å‹è½¬æ¢

**ä¿®å¤ç¤ºä¾‹**ï¼š
```java
// å¦‚æœå­—æ®µåº”è¯¥æ˜¯ Integer
permission.setType(Integer.parseInt(request.getType()));

// æˆ–è€…ä¿®æ”¹ Permission å®ä½“ç±»å­—æ®µç±»å‹
// private String type; -> private Integer type;
```

---

### 9. PerformanceMonitoringController é‡å¤æ–¹æ³• ğŸŸ¡

**é—®é¢˜æè¿°**ï¼š
```
[ERROR] PerformanceMonitoringController.java:[178,61] å·²åœ¨ç±»ä¸­å®šä¹‰äº†æ–¹æ³• getDetailedMetrics()
[ERROR] PerformanceMonitoringController.java:[191,61] å·²åœ¨ç±»ä¸­å®šä¹‰äº†æ–¹æ³• getPerformanceReport(String)
[ERROR] PerformanceMonitoringController.java:[206,61] å·²åœ¨ç±»ä¸­å®šä¹‰äº†æ–¹æ³• getOptimizationSuggestions()
[ERROR] PerformanceMonitoringController.java:[219,48] å·²åœ¨ç±»ä¸­å®šä¹‰äº†æ–¹æ³• recordRequestPerformance(long)
```

**ä¿®å¤æ­¥éª¤**ï¼š
1. æ‰“å¼€ `src/main/java/com/archive/management/controller/PerformanceMonitoringController.java`
2. æœç´¢é‡å¤çš„æ–¹æ³•å
3. åˆ é™¤é‡å¤çš„æ–¹æ³•å®šä¹‰ï¼Œä¿ç•™æ­£ç¡®çš„ç‰ˆæœ¬
4. é‡æ–°ç¼–è¯‘éªŒè¯

---

### 10. StreamExportServiceImpl ç¬¦å·é”™è¯¯ ğŸŸ¡

**é—®é¢˜æè¿°**ï¼š
çº¦ 12 ä¸ª "æ‰¾ä¸åˆ°ç¬¦å·" é”™è¯¯ï¼Œå¯èƒ½æ¶‰åŠï¼š
- ç¼ºå¤±çš„å¯¼å…¥
- æœªå®šä¹‰çš„æ–¹æ³•
- ç±»å‹ä¸åŒ¹é…

**æ’æŸ¥æ­¥éª¤**ï¼š
1. è¿è¡Œç¼–è¯‘è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š
   ```bash
   ./mvnw compile -DskipTests 2>&1 | grep "StreamExportServiceImpl" -A 2
   ```
2. æ ¹æ®å…·ä½“é”™è¯¯ä¿¡æ¯é€ä¸ªä¿®å¤

---

### 11. MonitoringService Gauge.builder é”™è¯¯ ğŸŸ¢

**é—®é¢˜æè¿°**ï¼š
```
[ERROR] MonitoringService.java:[123,14] æ— æ³•å°†æ¥å£ Gauge ä¸­çš„æ–¹æ³• builder åº”ç”¨åˆ°ç»™å®šç±»å‹
éœ€è¦: java.lang.String,T,java.util.function.ToDoubleFunction<T>
```

**å¯èƒ½åŸå› **ï¼š
Micrometer Gauge.builder() æ–¹æ³•è°ƒç”¨å‚æ•°ä¸æ­£ç¡®ã€‚

**ä¿®å¤ç¤ºä¾‹**ï¼š
```java
// é”™è¯¯çš„è°ƒç”¨
Gauge.builder("metric.name", object)
    .register(registry);

// æ­£ç¡®çš„è°ƒç”¨
Gauge.builder("metric.name", object, obj -> obj.getValue())
    .register(registry);
```

---

### 12. CacheService size() æ–¹æ³•é”™è¯¯ ğŸŸ¢

**é—®é¢˜æè¿°**ï¼š
```
[ERROR] CacheService.java:[251,42] æ‰¾ä¸åˆ°ç¬¦å·
ç¬¦å·: æ–¹æ³• size()
ä½ç½®: ç±» java.lang.Object
```

**å¯èƒ½åŸå› **ï¼š
æŸä¸ª Object ç±»å‹çš„å˜é‡è°ƒç”¨äº† size() æ–¹æ³•ï¼Œéœ€è¦å…ˆè½¬æ¢ä¸ºå…·ä½“ç±»å‹ï¼ˆå¦‚ Collectionï¼‰ã€‚

**ä¿®å¤ç¤ºä¾‹**ï¼š
```java
// é”™è¯¯
Object obj = cache.get(key);
int size = obj.size(); // Object æ²¡æœ‰ size() æ–¹æ³•

// æ­£ç¡®
Object obj = cache.get(key);
if (obj instanceof Collection) {
    int size = ((Collection<?>) obj).size();
}
```

---

## ğŸ“ æ–‡ä»¶ä¿®æ”¹æ¸…å•

### æ–°å»ºæ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | æ–‡ä»¶å¤§å° | è¯´æ˜ |
|---------|---------|------|
| `src/main/java/com/archive/management/util/JwtUtil.java` | ~250 è¡Œ | JWT å·¥å…·ç±» |

### ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹ç±»å‹ | ä¸»è¦å˜æ›´ |
|---------|---------|---------|
| `src/main/java/com/archive/management/service/impl/SystemServiceImpl.java` | é‡å¤§ä¿®æ”¹ | åˆ é™¤é‡å¤æ–¹æ³•ã€æ³¨é‡Šæ—¶é—´è®¾ç½® |
| `src/main/java/com/archive/management/service/SystemService.java` | è½»å¾®ä¿®æ”¹ | æ·»åŠ  UserResponse å¯¼å…¥ |
| `src/main/java/com/archive/management/util/CryptoUtil.java` | è½»å¾®ä¿®æ”¹ | æ·»åŠ  encryptAES/decryptAES æ–¹æ³• |
| `src/main/java/com/archive/management/config/PerformanceConfig.java` | è½»å¾®ä¿®æ”¹ | æ·»åŠ  PerformanceProperties å¯¼å…¥ |
| `src/main/java/com/archive/management/config/DatabaseOptimizationConfig.java` | è½»å¾®ä¿®æ”¹ | æ·»åŠ  DatabaseOptimizationProperties å¯¼å…¥ |

---

## ğŸ¯ å¿«é€Ÿä¿®å¤æŒ‡å—

### æ–¹æ¡ˆ Aï¼šå¿«é€Ÿç¼–è¯‘é€šè¿‡ï¼ˆé¢„è®¡ 1 å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šè®©é¡¹ç›®èƒ½å¤ŸæˆåŠŸç¼–è¯‘

**æ­¥éª¤**ï¼š
1. âœ… ä¿®å¤ SystemConfigMapper æ–¹æ³•ç¼ºå¤±ï¼ˆ30 åˆ†é’Ÿï¼‰
2. âœ… ä¿®å¤ SystemServiceImpl ç±»å‹è½¬æ¢é”™è¯¯ï¼ˆ10 åˆ†é’Ÿï¼‰
3. âœ… åˆ é™¤ PerformanceMonitoringController é‡å¤æ–¹æ³•ï¼ˆ10 åˆ†é’Ÿï¼‰
4. âœ… éªŒè¯ç¼–è¯‘é€šè¿‡

### æ–¹æ¡ˆ Bï¼šå®Œæ•´ä¿®å¤ï¼ˆé¢„è®¡ 2-3 å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šè§£å†³æ‰€æœ‰ç¼–è¯‘é”™è¯¯

**æ­¥éª¤**ï¼š
1. æ‰§è¡Œæ–¹æ¡ˆ A çš„æ‰€æœ‰æ­¥éª¤
2. ä¿®å¤ StreamExportServiceImpl ç¬¦å·é”™è¯¯ï¼ˆ15 åˆ†é’Ÿï¼‰
3. ä¿®å¤ MonitoringService Gauge.builder é”™è¯¯ï¼ˆ20 åˆ†é’Ÿï¼‰
4. ä¿®å¤ CacheService size() æ–¹æ³•é”™è¯¯ï¼ˆ5 åˆ†é’Ÿï¼‰
5. ä¿®å¤å…¶ä»–å‰©ä½™é”™è¯¯ï¼ˆ60-90 åˆ†é’Ÿï¼‰
6. å…¨é¢æµ‹è¯•éªŒè¯

---

## ğŸ”§ å¼€å‘ç¯å¢ƒé…ç½®

### å¿…éœ€çš„é…ç½®æ–‡ä»¶

#### application.yml
```yaml
# JWT é…ç½®
jwt:
  secret: your-secret-key-here-min-32-characters
  expiration: 86400  # 24å°æ—¶ï¼ˆç§’ï¼‰

# MyBatis-Plus é…ç½®
mybatis-plus:
  global-config:
    db-config:
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

### Maven ä¾èµ–æ£€æŸ¥

ç¡®ä¿ pom.xml ä¸­åŒ…å«ä»¥ä¸‹ä¾èµ–ï¼š

```xml
<!-- MyBatis-Plus -->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.5.3</version>
</dependency>

<!-- Lombok -->
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <optional>true</optional>
</dependency>

<!-- Spring Boot Starter Web -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
```

---

## ğŸ“ ç¼–è¯‘å‘½ä»¤å‚è€ƒ

### å¸¸ç”¨å‘½ä»¤

```bash
# æ¸…ç†å¹¶ç¼–è¯‘ï¼ˆè·³è¿‡æµ‹è¯•ï¼‰
./mvnw clean compile -DskipTests

# æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶çš„é”™è¯¯
./mvnw compile -DskipTests 2>&1 | grep "SystemServiceImpl"

# ç»Ÿè®¡é”™è¯¯æ•°é‡
./mvnw compile -DskipTests 2>&1 | grep "ERROR" | wc -l

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
./mvnw compile -DskipTests 2>&1 | grep -A 3 "ERROR"

# å®Œæ•´æ„å»ºï¼ˆåŒ…å«æµ‹è¯•ï¼‰
./mvnw clean install

# å¯åŠ¨åº”ç”¨
./mvnw spring-boot:run
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### Q1: Lombok æ³¨è§£ä¸ç”Ÿæ•ˆ

**ç—‡çŠ¶**ï¼šæ‰¾ä¸åˆ° getter/setter æ–¹æ³•

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ IDE å®‰è£…äº† Lombok æ’ä»¶
2. å¯ç”¨æ³¨è§£å¤„ç†ï¼šSettings â†’ Build â†’ Compiler â†’ Annotation Processors â†’ Enable annotation processing
3. é‡æ–°æ„å»ºé¡¹ç›®ï¼šBuild â†’ Rebuild Project

### Q2: MyBatis-Plus è‡ªåŠ¨å¡«å……ä¸å·¥ä½œ

**ç—‡çŠ¶**ï¼šcreateTime/updateTime ä¸º null

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ˜¯å¦é…ç½®äº† MetaObjectHandlerï¼š
   ```java
   @Component
   public class MyMetaObjectHandler implements MetaObjectHandler {
       @Override
       public void insertFill(MetaObject metaObject) {
           this.strictInsertFill(metaObject, "createTime", LocalDateTime.class, LocalDateTime.now());
           this.strictInsertFill(metaObject, "updateTime", LocalDateTime.class, LocalDateTime.now());
       }
       
       @Override
       public void updateFill(MetaObject metaObject) {
           this.strictUpdateFill(metaObject, "updateTime", LocalDateTime.class, LocalDateTime.now());
       }
   }
   ```

### Q3: Mapper æ–¹æ³•æ‰¾ä¸åˆ°

**ç—‡çŠ¶**ï¼šç¼–è¯‘é”™è¯¯ "æ‰¾ä¸åˆ°ç¬¦å·"

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ Mapper æ¥å£æœ‰ @Mapper æ³¨è§£
2. ç¡®è®¤ Spring Boot ä¸»ç±»æœ‰ @MapperScan æ³¨è§£
3. æ£€æŸ¥æ–¹æ³•ç­¾åæ˜¯å¦æ­£ç¡®

---

## ğŸ“Š æŠ€æœ¯å€ºåŠ¡è®°å½•

### ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

| é¡¹ç›® | å½“å‰çŠ¶æ€ | å»ºè®®æ”¹è¿› | ä¼˜å…ˆçº§ |
|------|---------|---------|--------|
| JwtUtil ç®€åŒ–å®ç° | ä½¿ç”¨ Base64 + SHA-256 | æ›¿æ¢ä¸º jjwt åº“ | é«˜ |
| æ—¶é—´å­—æ®µæ³¨é‡Šå¤„ç† | ä¾èµ–è‡ªåŠ¨å¡«å…… | ç¡®è®¤é…ç½®æ­£ç¡® | ä¸­ |
| é”™è¯¯å¤„ç† | éƒ¨åˆ†ç¼ºå¤± | ç»Ÿä¸€å¼‚å¸¸å¤„ç† | ä¸­ |
| æ—¥å¿—è®°å½• | ä¸å®Œæ•´ | å®Œå–„å®¡è®¡æ—¥å¿— | ä½ |

### éœ€è¦ä¼˜åŒ–çš„éƒ¨åˆ†

1. **å®‰å…¨æ€§**
   - JWT å¯†é’¥åº”ä½¿ç”¨ç¯å¢ƒå˜é‡
   - æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
   - æ·»åŠ è¯·æ±‚ç­¾åéªŒè¯

2. **æ€§èƒ½**
   - æ·»åŠ ç¼“å­˜æœºåˆ¶
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
   - å®ç°åˆ†é¡µæŸ¥è¯¢

3. **å¯ç»´æŠ¤æ€§**
   - ç»Ÿä¸€é”™è¯¯ç 
   - å®Œå–„ API æ–‡æ¡£
   - æ·»åŠ å•å…ƒæµ‹è¯•

---

## âœ… éªŒè¯æ¸…å•

ä¿®å¤å®Œæˆåï¼Œè¯·æŒ‰ä»¥ä¸‹æ¸…å•éªŒè¯ï¼š

### ç¼–è¯‘éªŒè¯
- [ ] `mvn clean compile` æ— é”™è¯¯
- [ ] æ‰€æœ‰ Java æ–‡ä»¶ç¼–è¯‘é€šè¿‡
- [ ] æ— è­¦å‘Šä¿¡æ¯ï¼ˆæˆ–è­¦å‘Šå¯æ¥å—ï¼‰

### åŠŸèƒ½éªŒè¯
- [ ] åº”ç”¨ç¨‹åºèƒ½å¤Ÿå¯åŠ¨
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] JWT è®¤è¯åŠŸèƒ½æ­£å¸¸
- [ ] æ ¸å¿ƒ CRUD æ“ä½œæ­£å¸¸

### ä»£ç è´¨é‡éªŒè¯
- [ ] ä»£ç æ ¼å¼ç¬¦åˆè§„èŒƒ
- [ ] æ— æ˜æ˜¾çš„ä»£ç å¼‚å‘³
- [ ] æ—¥å¿—è¾“å‡ºæ­£å¸¸
- [ ] å¼‚å¸¸å¤„ç†å®Œå–„

---

## ğŸ“ åç»­æ”¯æŒ

### ç»§ç»­ä¿®å¤å»ºè®®

1. **æ–°å¼€å¯¹è¯**ï¼šé¿å…ä¸Šä¸‹æ–‡è¿‡é•¿å½±å“æ•ˆç‡
2. **æä¾›å…·ä½“é”™è¯¯**ï¼šå¤åˆ¶å®Œæ•´çš„ç¼–è¯‘é”™è¯¯ä¿¡æ¯
3. **æ˜ç¡®ä¼˜å…ˆçº§**ï¼šè¯´æ˜å“ªäº›é”™è¯¯éœ€è¦ä¼˜å…ˆä¿®å¤
4. **ä¿å­˜è¿›åº¦**ï¼šå®šæœŸæäº¤ä»£ç åˆ° Git

### ç›¸å…³æ–‡æ¡£

- [MyBatis-Plus å®˜æ–¹æ–‡æ¡£](https://baomidou.com/)
- [Spring Boot å®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-boot)
- [Lombok ä½¿ç”¨æŒ‡å—](https://projectlombok.org/)

---

## ğŸ“Œ é™„å½•

### A. é”™è¯¯ä»£ç å¯¹ç…§è¡¨

| é”™è¯¯ä»£ç  | è¯´æ˜ | å¸¸è§åŸå›  |
|---------|------|---------|
| æ‰¾ä¸åˆ°ç¬¦å· | ç±»ã€æ–¹æ³•æˆ–å˜é‡æœªå®šä¹‰ | ç¼ºå°‘å¯¼å…¥ã€æ‹¼å†™é”™è¯¯ |
| ä¸å…¼å®¹çš„ç±»å‹ | ç±»å‹è½¬æ¢é”™è¯¯ | ç±»å‹ä¸åŒ¹é…ã€ç¼ºå°‘è½¬æ¢ |
| å·²åœ¨ç±»ä¸­å®šä¹‰ | é‡å¤çš„æ–¹æ³•æˆ–å­—æ®µ | æ–¹æ³•ç­¾åå†²çª |
| éœ€è¦';' | è¯­æ³•é”™è¯¯ | ç¼ºå°‘åˆ†å·ã€æ‹¬å·ä¸åŒ¹é… |

### B. é¡¹ç›®ç»“æ„è¯´æ˜

```
src/main/java/com/archive/management/
â”œâ”€â”€ config/              # é…ç½®ç±»
â”‚   â”œâ”€â”€ properties/      # é…ç½®å±æ€§ç±»
â”‚   â”œâ”€â”€ PerformanceConfig.java
â”‚   â””â”€â”€ DatabaseOptimizationConfig.java
â”œâ”€â”€ controller/          # æ§åˆ¶å™¨
â”œâ”€â”€ service/            # æœåŠ¡æ¥å£
â”‚   â””â”€â”€ impl/           # æœåŠ¡å®ç°
â”œâ”€â”€ mapper/             # MyBatis Mapper
â”œâ”€â”€ entity/             # å®ä½“ç±»
â”œâ”€â”€ dto/                # æ•°æ®ä¼ è¾“å¯¹è±¡
â”œâ”€â”€ util/               # å·¥å…·ç±»
â”‚   â”œâ”€â”€ JwtUtil.java    # JWT å·¥å…·ï¼ˆæ–°å»ºï¼‰
â”‚   â””â”€â”€ CryptoUtil.java # åŠ å¯†å·¥å…·ï¼ˆå·²ä¿®æ”¹ï¼‰
â””â”€â”€ common/             # å…¬å…±ç±»
    â””â”€â”€ entity/
        â””â”€â”€ BaseEntity.java
```

---

**æŠ¥å‘Šç»“æŸ**

> ğŸ’¡ **æç¤º**ï¼šå»ºè®®å°†æœ¬æŠ¥å‘Šä¿å­˜åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œå¹¶åœ¨ä¿®å¤è¿‡ç¨‹ä¸­éšæ—¶å‚è€ƒã€‚å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥é˜…ç›¸å…³ç« èŠ‚æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚

**æœ€åæ›´æ–°**ï¼š2024å¹´  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0

