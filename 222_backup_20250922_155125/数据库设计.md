# 档案管理系统 - 数据库设计文档

## 1. 文档概述

### 1.1 文档目的
本文档详细描述档案管理系统的数据库设计，包括数据模型、表结构、索引策略、约束关系等，为数据库开发和维护提供技术指导。

### 1.2 设计原则
- **规范化设计**：遵循第三范式，减少数据冗余
- **性能优化**：合理设计索引，优化查询性能
- **扩展性**：支持业务扩展和数据增长
- **安全性**：敏感数据加密存储，权限控制
- **完整性**：外键约束，数据一致性保证

## 2. 数据库概览

### 2.1 数据库信息
- **数据库名称**：archive_management_system
- **字符集**：utf8mb4
- **排序规则**：utf8mb4_unicode_ci
- **存储引擎**：InnoDB
- **数据库版本**：MySQL 8.0+

### 2.2 数据库分库策略
```
archive_management_system (主库)
├── user_db (用户相关表)
├── archive_db (档案相关表)
├── workflow_db (流程相关表)
├── system_db (系统配置表)
└── log_db (日志审计表)
```

## 3. 数据模型设计

### 3.1 实体关系图(ER图)

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│    用户      │    │    部门      │    │    角色      │
│   (User)    │────│ (Department)│    │   (Role)    │
│             │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │
       │                   │                   │
       └───────────────────┼───────────────────┘
                           │
                           ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   用户角色   │    │    档案      │    │  档案分类    │
│ (UserRole)  │    │  (Archive)  │────│ (Category)  │
│             │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘
                           │
                           │
                           ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│    文件      │    │   借阅申请   │    │  操作日志    │
│   (File)    │────│  (Borrow)   │    │    (Log)    │
│             │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘
```

### 3.2 核心业务流程数据流

```
用户提交档案 → 档案审核 → 档案归档 → 档案检索 → 借阅申请 → 借阅审批 → 档案归还
     │           │         │         │         │         │         │
     ▼           ▼         ▼         ▼         ▼         ▼         ▼
  档案表      审核记录   状态更新   检索日志   借阅表    审批记录   归还记录
```

## 4. 数据表设计

### 4.1 用户管理模块

#### 4.1.1 用户表 (sys_user)
```sql
CREATE TABLE `sys_user` (
  `user_id` bigint NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `username` varchar(50) NOT NULL COMMENT '用户名',
  `password` varchar(255) NOT NULL COMMENT '密码(加密)',
  `salt` varchar(50) NOT NULL COMMENT '密码盐值',
  `real_name` varchar(100) NOT NULL COMMENT '真实姓名',
  `email` varchar(100) DEFAULT NULL COMMENT '邮箱',
  `phone` varchar(20) DEFAULT NULL COMMENT '手机号',
  `avatar` varchar(255) DEFAULT NULL COMMENT '头像URL',
  `department_id` bigint DEFAULT NULL COMMENT '部门ID',
  `employee_no` varchar(50) DEFAULT NULL COMMENT '员工编号',
  `position` varchar(100) DEFAULT NULL COMMENT '职位',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT '状态(0:禁用 1:启用)',
  `last_login_time` datetime DEFAULT NULL COMMENT '最后登录时间',
  `last_login_ip` varchar(50) DEFAULT NULL COMMENT '最后登录IP',
  `login_count` int DEFAULT '0' COMMENT '登录次数',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `create_user_id` bigint DEFAULT NULL COMMENT '创建人ID',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `update_user_id` bigint DEFAULT NULL COMMENT '更新人ID',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  PRIMARY KEY (`user_id`),
  UNIQUE KEY `uk_username` (`username`),
  UNIQUE KEY `uk_employee_no` (`employee_no`),
  KEY `idx_department_id` (`department_id`),
  KEY `idx_status` (`status`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';
```

#### 4.1.2 部门表 (sys_department)
```sql
CREATE TABLE `sys_department` (
  `department_id` bigint NOT NULL AUTO_INCREMENT COMMENT '部门ID',
  `parent_id` bigint DEFAULT '0' COMMENT '父部门ID',
  `department_name` varchar(100) NOT NULL COMMENT '部门名称',
  `department_code` varchar(50) NOT NULL COMMENT '部门编码',
  `leader_user_id` bigint DEFAULT NULL COMMENT '部门负责人ID',
  `phone` varchar(20) DEFAULT NULL COMMENT '联系电话',
  `email` varchar(100) DEFAULT NULL COMMENT '邮箱',
  `sort_order` int DEFAULT '0' COMMENT '排序',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT '状态(0:禁用 1:启用)',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `create_user_id` bigint DEFAULT NULL COMMENT '创建人ID',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `update_user_id` bigint DEFAULT NULL COMMENT '更新人ID',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  PRIMARY KEY (`department_id`),
  UNIQUE KEY `uk_department_code` (`department_code`),
  KEY `idx_parent_id` (`parent_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='部门表';
```

#### 4.1.3 角色表 (sys_role)
```sql
CREATE TABLE `sys_role` (
  `role_id` bigint NOT NULL AUTO_INCREMENT COMMENT '角色ID',
  `role_name` varchar(100) NOT NULL COMMENT '角色名称',
  `role_code` varchar(50) NOT NULL COMMENT '角色编码',
  `role_type` tinyint NOT NULL DEFAULT '2' COMMENT '角色类型(1:系统内置 2:自定义)',
  `data_scope` tinyint NOT NULL DEFAULT '4' COMMENT '数据权限(1:全部 2:本部门及下级 3:本部门 4:仅本人)',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT '状态(0:禁用 1:启用)',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `create_user_id` bigint DEFAULT NULL COMMENT '创建人ID',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `update_user_id` bigint DEFAULT NULL COMMENT '更新人ID',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  PRIMARY KEY (`role_id`),
  UNIQUE KEY `uk_role_code` (`role_code`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='角色表';
```

#### 4.1.4 用户角色关联表 (sys_user_role)
```sql
CREATE TABLE `sys_user_role` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `role_id` bigint NOT NULL COMMENT '角色ID',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `create_user_id` bigint DEFAULT NULL COMMENT '创建人ID',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_role` (`user_id`,`role_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_role_id` (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户角色关联表';
```

### 4.2 档案管理模块

#### 4.2.1 档案分类表 (arc_category)
```sql
CREATE TABLE `arc_category` (
  `category_id` bigint NOT NULL AUTO_INCREMENT COMMENT '分类ID',
  `parent_id` bigint DEFAULT '0' COMMENT '父分类ID',
  `category_name` varchar(100) NOT NULL COMMENT '分类名称',
  `category_code` varchar(50) NOT NULL COMMENT '分类编码',
  `category_level` tinyint NOT NULL DEFAULT '1' COMMENT '分类层级',
  `default_security_level` tinyint DEFAULT '1' COMMENT '默认密级(1:公开 2:内部 3:机密 4:绝密)',
  `retention_period` varchar(20) DEFAULT '长期' COMMENT '保存期限',
  `business_type` varchar(100) DEFAULT NULL COMMENT '业务类型',
  `sort_order` int DEFAULT '0' COMMENT '排序',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT '状态(0:禁用 1:启用)',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `create_user_id` bigint DEFAULT NULL COMMENT '创建人ID',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `update_user_id` bigint DEFAULT NULL COMMENT '更新人ID',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  PRIMARY KEY (`category_id`),
  UNIQUE KEY `uk_category_code` (`category_code`),
  KEY `idx_parent_id` (`parent_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='档案分类表';
```

#### 4.2.2 档案表 (arc_archive)
```sql
CREATE TABLE `arc_archive` (
  `archive_id` bigint NOT NULL AUTO_INCREMENT COMMENT '档案ID',
  `archive_no` varchar(50) NOT NULL COMMENT '档案编号',
  `title` varchar(200) NOT NULL COMMENT '档案标题',
  `category_id` bigint NOT NULL COMMENT '分类ID',
  `security_level` tinyint NOT NULL DEFAULT '1' COMMENT '密级(1:公开 2:内部 3:机密 4:绝密)',
  `business_id` varchar(100) DEFAULT NULL COMMENT '关联业务ID',
  `keywords` varchar(500) DEFAULT NULL COMMENT '关键词',
  `abstract` text COMMENT '摘要',
  `metadata_json` json DEFAULT NULL COMMENT '元数据JSON',
  `file_count` int DEFAULT '0' COMMENT '文件数量',
  `total_size` bigint DEFAULT '0' COMMENT '总文件大小(字节)',
  `retention_period` varchar(20) DEFAULT '长期' COMMENT '保存期限',
  `expiry_date` date DEFAULT NULL COMMENT '到期日期',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT '状态(1:待审核 2:已归档 3:已借出 4:审核驳回 5:已销毁)',
  `submit_user_id` bigint NOT NULL COMMENT '提交人ID',
  `submit_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '提交时间',
  `archive_user_id` bigint DEFAULT NULL COMMENT '归档人ID',
  `archive_time` datetime DEFAULT NULL COMMENT '归档时间',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  PRIMARY KEY (`archive_id`),
  UNIQUE KEY `uk_archive_no` (`archive_no`),
  KEY `idx_category_id` (`category_id`),
  KEY `idx_security_level` (`security_level`),
  KEY `idx_business_id` (`business_id`),
  KEY `idx_status` (`status`),
  KEY `idx_submit_user_id` (`submit_user_id`),
  KEY `idx_submit_time` (`submit_time`),
  KEY `idx_archive_time` (`archive_time`),
  FULLTEXT KEY `ft_title_keywords` (`title`,`keywords`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='档案表';
```

#### 4.2.3 档案文件表 (arc_file)
```sql
CREATE TABLE `arc_file` (
  `file_id` bigint NOT NULL AUTO_INCREMENT COMMENT '文件ID',
  `archive_id` bigint NOT NULL COMMENT '档案ID',
  `file_name` varchar(255) NOT NULL COMMENT '文件名',
  `original_name` varchar(255) NOT NULL COMMENT '原始文件名',
  `file_path` varchar(500) NOT NULL COMMENT '文件路径',
  `file_size` bigint NOT NULL COMMENT '文件大小(字节)',
  `file_type` varchar(50) NOT NULL COMMENT '文件类型',
  `mime_type` varchar(100) NOT NULL COMMENT 'MIME类型',
  `file_hash` varchar(64) NOT NULL COMMENT '文件哈希值(SHA256)',
  `thumbnail_path` varchar(500) DEFAULT NULL COMMENT '缩略图路径',
  `page_count` int DEFAULT NULL COMMENT '页数(PDF等)',
  `is_encrypted` tinyint DEFAULT '0' COMMENT '是否加密(0:否 1:是)',
  `sort_order` int DEFAULT '0' COMMENT '排序',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT '状态(0:删除 1:正常)',
  `upload_user_id` bigint NOT NULL COMMENT '上传人ID',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`file_id`),
  KEY `idx_archive_id` (`archive_id`),
  KEY `idx_file_hash` (`file_hash`),
  KEY `idx_upload_user_id` (`upload_user_id`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='档案文件表';
```

#### 4.2.4 元数据模板表 (arc_metadata_template)
```sql
CREATE TABLE `arc_metadata_template` (
  `template_id` bigint NOT NULL AUTO_INCREMENT COMMENT '模板ID',
  `category_id` bigint NOT NULL COMMENT '分类ID',
  `field_name` varchar(100) NOT NULL COMMENT '字段名称',
  `field_code` varchar(50) NOT NULL COMMENT '字段编码',
  `field_type` varchar(20) NOT NULL COMMENT '字段类型(text/number/date/select/boolean/file)',
  `field_options` json DEFAULT NULL COMMENT '字段选项(下拉框等)',
  `is_required` tinyint DEFAULT '0' COMMENT '是否必填(0:否 1:是)',
  `default_value` varchar(500) DEFAULT NULL COMMENT '默认值',
  `validation_rule` varchar(200) DEFAULT NULL COMMENT '验证规则',
  `sort_order` int DEFAULT '0' COMMENT '排序',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT '状态(0:禁用 1:启用)',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `create_user_id` bigint DEFAULT NULL COMMENT '创建人ID',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `update_user_id` bigint DEFAULT NULL COMMENT '更新人ID',
  PRIMARY KEY (`template_id`),
  KEY `idx_category_id` (`category_id`),
  KEY `idx_field_code` (`field_code`),
  KEY `idx_sort_order` (`sort_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='元数据模板表';
```

### 4.3 借阅管理模块

#### 4.3.1 借阅申请表 (arc_borrow)
```sql
CREATE TABLE `arc_borrow` (
  `borrow_id` bigint NOT NULL AUTO_INCREMENT COMMENT '借阅ID',
  `borrow_no` varchar(50) NOT NULL COMMENT '借阅编号',
  `archive_id` bigint NOT NULL COMMENT '档案ID',
  `apply_user_id` bigint NOT NULL COMMENT '申请人ID',
  `purpose` varchar(500) NOT NULL COMMENT '借阅用途',
  `expected_days` int NOT NULL DEFAULT '7' COMMENT '期望借阅天数',
  `actual_days` int DEFAULT NULL COMMENT '实际批准天数',
  `borrow_start_time` datetime DEFAULT NULL COMMENT '借阅开始时间',
  `borrow_end_time` datetime DEFAULT NULL COMMENT '借阅结束时间',
  `return_time` datetime DEFAULT NULL COMMENT '归还时间',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT '状态(1:待审批 2:已批准 3:已拒绝 4:借阅中 5:已归还 6:已逾期)',
  `approve_user_id` bigint DEFAULT NULL COMMENT '审批人ID',
  `approve_time` datetime DEFAULT NULL COMMENT '审批时间',
  `approve_remark` varchar(500) DEFAULT NULL COMMENT '审批备注',
  `apply_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '申请时间',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  PRIMARY KEY (`borrow_id`),
  UNIQUE KEY `uk_borrow_no` (`borrow_no`),
  KEY `idx_archive_id` (`archive_id`),
  KEY `idx_apply_user_id` (`apply_user_id`),
  KEY `idx_status` (`status`),
  KEY `idx_apply_time` (`apply_time`),
  KEY `idx_borrow_end_time` (`borrow_end_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='借阅申请表';
```

### 4.4 系统管理模块

#### 4.4.1 系统配置表 (sys_config)
```sql
CREATE TABLE `sys_config` (
  `config_id` bigint NOT NULL AUTO_INCREMENT COMMENT '配置ID',
  `config_key` varchar(100) NOT NULL COMMENT '配置键',
  `config_value` text NOT NULL COMMENT '配置值',
  `config_type` varchar(20) NOT NULL DEFAULT 'string' COMMENT '配置类型',
  `config_group` varchar(50) DEFAULT 'default' COMMENT '配置分组',
  `config_desc` varchar(200) DEFAULT NULL COMMENT '配置描述',
  `is_system` tinyint DEFAULT '0' COMMENT '是否系统配置(0:否 1:是)',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `create_user_id` bigint DEFAULT NULL COMMENT '创建人ID',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `update_user_id` bigint DEFAULT NULL COMMENT '更新人ID',
  PRIMARY KEY (`config_id`),
  UNIQUE KEY `uk_config_key` (`config_key`),
  KEY `idx_config_group` (`config_group`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='系统配置表';
```

#### 4.4.2 操作日志表 (sys_operation_log)
```sql
CREATE TABLE `sys_operation_log` (
  `log_id` bigint NOT NULL AUTO_INCREMENT COMMENT '日志ID',
  `user_id` bigint DEFAULT NULL COMMENT '用户ID',
  `username` varchar(50) DEFAULT NULL COMMENT '用户名',
  `operation_type` varchar(50) NOT NULL COMMENT '操作类型',
  `operation_desc` varchar(200) DEFAULT NULL COMMENT '操作描述',
  `target_type` varchar(50) DEFAULT NULL COMMENT '目标类型',
  `target_id` varchar(100) DEFAULT NULL COMMENT '目标ID',
  `request_method` varchar(10) DEFAULT NULL COMMENT '请求方法',
  `request_url` varchar(500) DEFAULT NULL COMMENT '请求URL',
  `request_params` text COMMENT '请求参数',
  `response_result` text COMMENT '响应结果',
  `client_ip` varchar(50) DEFAULT NULL COMMENT '客户端IP',
  `user_agent` varchar(500) DEFAULT NULL COMMENT '用户代理',
  `execution_time` int DEFAULT NULL COMMENT '执行时间(毫秒)',
  `status` tinyint DEFAULT '1' COMMENT '状态(0:失败 1:成功)',
  `error_msg` text COMMENT '错误信息',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`log_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_operation_type` (`operation_type`),
  KEY `idx_target_type_id` (`target_type`,`target_id`),
  KEY `idx_create_time` (`create_time`),
  KEY `idx_client_ip` (`client_ip`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='操作日志表';
```

#### 4.4.3 登录日志表 (sys_login_log)
```sql
CREATE TABLE `sys_login_log` (
  `log_id` bigint NOT NULL AUTO_INCREMENT COMMENT '日志ID',
  `user_id` bigint DEFAULT NULL COMMENT '用户ID',
  `username` varchar(50) NOT NULL COMMENT '用户名',
  `login_type` varchar(20) DEFAULT 'password' COMMENT '登录类型(password/sso/ldap)',
  `client_ip` varchar(50) NOT NULL COMMENT '客户端IP',
  `client_location` varchar(100) DEFAULT NULL COMMENT '客户端位置',
  `user_agent` varchar(500) DEFAULT NULL COMMENT '用户代理',
  `browser` varchar(50) DEFAULT NULL COMMENT '浏览器',
  `os` varchar(50) DEFAULT NULL COMMENT '操作系统',
  `status` tinyint NOT NULL COMMENT '状态(0:失败 1:成功)',
  `error_msg` varchar(200) DEFAULT NULL COMMENT '错误信息',
  `login_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '登录时间',
  PRIMARY KEY (`log_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_username` (`username`),
  KEY `idx_client_ip` (`client_ip`),
  KEY `idx_login_time` (`login_time`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='登录日志表';
```

## 5. 索引设计策略

### 5.1 主键索引
- 所有表均使用自增主键 `bigint AUTO_INCREMENT`
- 主键命名规范：`表名_id`

### 5.2 唯一索引
```sql
-- 用户表
ALTER TABLE sys_user ADD UNIQUE KEY uk_username (username);
ALTER TABLE sys_user ADD UNIQUE KEY uk_employee_no (employee_no);

-- 档案表
ALTER TABLE arc_archive ADD UNIQUE KEY uk_archive_no (archive_no);

-- 分类表
ALTER TABLE arc_category ADD UNIQUE KEY uk_category_code (category_code);
```

### 5.3 复合索引
```sql
-- 用户角色关联表
ALTER TABLE sys_user_role ADD UNIQUE KEY uk_user_role (user_id, role_id);

-- 档案表复合查询索引
ALTER TABLE arc_archive ADD KEY idx_category_status_time (category_id, status, submit_time);
ALTER TABLE arc_archive ADD KEY idx_user_status_time (submit_user_id, status, submit_time);

-- 借阅表复合查询索引
ALTER TABLE arc_borrow ADD KEY idx_user_status_time (apply_user_id, status, apply_time);
ALTER TABLE arc_borrow ADD KEY idx_archive_status (archive_id, status);
```

### 5.4 全文索引
```sql
-- 档案表全文检索
ALTER TABLE arc_archive ADD FULLTEXT KEY ft_title_keywords (title, keywords);
```

### 5.5 分区策略
```sql
-- 操作日志表按月分区
ALTER TABLE sys_operation_log PARTITION BY RANGE (YEAR(create_time)*100 + MONTH(create_time)) (
    PARTITION p202501 VALUES LESS THAN (202502),
    PARTITION p202502 VALUES LESS THAN (202503),
    PARTITION p202503 VALUES LESS THAN (202504),
    -- ... 继续添加分区
    PARTITION p_max VALUES LESS THAN MAXVALUE
);
```

## 6. 约束与触发器

### 6.1 外键约束
```sql
-- 用户表外键
ALTER TABLE sys_user ADD CONSTRAINT fk_user_department 
    FOREIGN KEY (department_id) REFERENCES sys_department(department_id);

-- 档案表外键
ALTER TABLE arc_archive ADD CONSTRAINT fk_archive_category 
    FOREIGN KEY (category_id) REFERENCES arc_category(category_id);
ALTER TABLE arc_archive ADD CONSTRAINT fk_archive_submit_user 
    FOREIGN KEY (submit_user_id) REFERENCES sys_user(user_id);

-- 文件表外键
ALTER TABLE arc_file ADD CONSTRAINT fk_file_archive 
    FOREIGN KEY (archive_id) REFERENCES arc_archive(archive_id) ON DELETE CASCADE;
```

### 6.2 检查约束
```sql
-- 状态值检查
ALTER TABLE sys_user ADD CONSTRAINT chk_user_status 
    CHECK (status IN (0, 1));

ALTER TABLE arc_archive ADD CONSTRAINT chk_archive_status 
    CHECK (status IN (1, 2, 3, 4, 5));

ALTER TABLE arc_archive ADD CONSTRAINT chk_security_level 
    CHECK (security_level IN (1, 2, 3, 4));
```

### 6.3 触发器设计
```sql
-- 档案编号自动生成触发器
DELIMITER $$
CREATE TRIGGER tr_archive_no_generate 
    BEFORE INSERT ON arc_archive
    FOR EACH ROW
BEGIN
    IF NEW.archive_no IS NULL OR NEW.archive_no = '' THEN
        SET NEW.archive_no = CONCAT('DA-', YEAR(NOW()), '-', 
            LPAD((SELECT IFNULL(MAX(SUBSTRING(archive_no, -6)), 0) + 1 
                  FROM arc_archive 
                  WHERE archive_no LIKE CONCAT('DA-', YEAR(NOW()), '-%')), 6, '0'));
    END IF;
END$$
DELIMITER ;

-- 文件统计更新触发器
DELIMITER $$
CREATE TRIGGER tr_file_count_update 
    AFTER INSERT ON arc_file
    FOR EACH ROW
BEGIN
    UPDATE arc_archive 
    SET file_count = (SELECT COUNT(*) FROM arc_file WHERE archive_id = NEW.archive_id AND status = 1),
        total_size = (SELECT IFNULL(SUM(file_size), 0) FROM arc_file WHERE archive_id = NEW.archive_id AND status = 1)
    WHERE archive_id = NEW.archive_id;
END$$
DELIMITER ;
```

## 7. 数据字典

### 7.1 枚举值定义

#### 7.1.1 用户状态 (user_status)
| 值 | 含义 | 说明 |
|----|------|------|
| 0 | 禁用 | 用户被禁用，无法登录 |
| 1 | 启用 | 用户正常状态 |

#### 7.1.2 档案状态 (archive_status)
| 值 | 含义 | 说明 |
|----|------|------|
| 1 | 待审核 | 档案提交后等待审核 |
| 2 | 已归档 | 档案审核通过，正式归档 |
| 3 | 已借出 | 档案被借阅中 |
| 4 | 审核驳回 | 档案审核未通过 |
| 5 | 已销毁 | 档案已销毁 |

#### 7.1.3 密级 (security_level)
| 值 | 含义 | 说明 |
|----|------|------|
| 1 | 公开 | 所有用户可访问 |
| 2 | 内部 | 内部用户可访问 |
| 3 | 机密 | 需要特殊权限 |
| 4 | 绝密 | 最高级别权限 |

#### 7.1.4 借阅状态 (borrow_status)
| 值 | 含义 | 说明 |
|----|------|------|
| 1 | 待审批 | 借阅申请提交，等待审批 |
| 2 | 已批准 | 审批通过，等待借阅 |
| 3 | 已拒绝 | 审批拒绝 |
| 4 | 借阅中 | 正在借阅 |
| 5 | 已归还 | 借阅结束，已归还 |
| 6 | 已逾期 | 超过借阅期限 |

### 7.2 字段类型说明

#### 7.2.1 元数据字段类型 (field_type)
| 类型 | 说明 | 示例 |
|------|------|------|
| text | 单行文本 | 合同编号 |
| textarea | 多行文本 | 备注说明 |
| number | 数字 | 金额、数量 |
| date | 日期 | 签署日期 |
| datetime | 日期时间 | 创建时间 |
| select | 下拉选择 | 状态选择 |
| boolean | 布尔值 | 是否有效 |
| file | 文件 | 附件上传 |

## 8. 性能优化建议

### 8.1 查询优化
- **分页查询**：使用 `LIMIT` 和 `OFFSET`，避免大结果集
- **索引覆盖**：查询字段尽量被索引覆盖
- **避免全表扫描**：WHERE条件使用索引字段
- **合理使用JOIN**：避免过多表关联

### 8.2 存储优化
- **数据类型选择**：使用合适的数据类型，节省存储空间
- **字段长度**：根据实际需求设置字段长度
- **NULL值处理**：合理使用NULL和默认值
- **大字段分离**：将大文本字段分离到单独表

### 8.3 维护策略
- **定期分析表**：`ANALYZE TABLE` 更新统计信息
- **重建索引**：定期 `OPTIMIZE TABLE` 整理碎片
- **监控慢查询**：开启慢查询日志，优化慢SQL
- **数据归档**：定期归档历史数据

## 9. 备份与恢复

### 9.1 备份策略
```bash
# 全量备份
mysqldump --single-transaction --routines --triggers \
  --master-data=2 archive_management_system > backup_full_$(date +%Y%m%d).sql

# 增量备份(基于binlog)
mysqlbinlog --start-datetime="2025-01-01 00:00:00" \
  --stop-datetime="2025-01-01 23:59:59" mysql-bin.000001 > backup_inc_$(date +%Y%m%d).sql
```

### 9.2 恢复策略
```bash
# 全量恢复
mysql archive_management_system < backup_full_20250101.sql

# 增量恢复
mysql archive_management_system < backup_inc_20250101.sql
```

## 10. 数据迁移方案

### 10.1 初始化数据
```sql
-- 插入默认角色
INSERT INTO sys_role (role_name, role_code, role_type, data_scope, remark) VALUES
('系统管理员', 'SYSTEM_ADMIN', 1, 1, '系统管理员角色'),
('档案管理员', 'ARCHIVE_ADMIN', 1, 2, '档案管理员角色'),
('高级用户', 'SENIOR_USER', 1, 3, '高级用户角色'),
('普通用户', 'NORMAL_USER', 1, 4, '普通用户角色');

-- 插入默认部门
INSERT INTO sys_department (department_name, department_code, parent_id) VALUES
('总公司', 'ROOT', 0),
('行政部', 'ADMIN', 1),
('人事部', 'HR', 1),
('财务部', 'FINANCE', 1),
('技术部', 'TECH', 1);

-- 插入默认分类
INSERT INTO arc_category (category_name, category_code, parent_id, default_security_level) VALUES
('人事档案', 'HR', 0, 2),
('财务档案', 'FINANCE', 0, 3),
('合同档案', 'CONTRACT', 0, 2),
('技术档案', 'TECH', 0, 2);
```

---

**文档版本**：v1.0  
**创建日期**：2025年1月  
**更新日期**：2025年1月  
**文档状态**：待评审