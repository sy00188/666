# æ¡£æ¡ˆç®¡ç†ç³»ç»Ÿ - æµ‹è¯•è§„èŒƒæ–‡æ¡£

**ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025å¹´10æœˆ15æ—¥  
**è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ  
**çŠ¶æ€**: æ­£å¼å‘å¸ƒ

---

## ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [æµ‹è¯•ç­–ç•¥](#æµ‹è¯•ç­–ç•¥)
3. [åç«¯æµ‹è¯•è§„èŒƒ](#åç«¯æµ‹è¯•è§„èŒƒ)
4. [å‰ç«¯æµ‹è¯•è§„èŒƒ](#å‰ç«¯æµ‹è¯•è§„èŒƒ)
5. [æµ‹è¯•ç¼–å†™æŒ‡å—](#æµ‹è¯•ç¼–å†™æŒ‡å—)
6. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
7. [ä»£ç è¦†ç›–ç‡è¦æ±‚](#ä»£ç è¦†ç›–ç‡è¦æ±‚)
8. [æµ‹è¯•å‘½åè§„èŒƒ](#æµ‹è¯•å‘½åè§„èŒƒ)
9. [Mockä¸Stubä½¿ç”¨æŒ‡å—](#mockä¸stubä½¿ç”¨æŒ‡å—)
10. [CI/CDé›†æˆ](#cicdé›†æˆ)
11. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
12. [é™„å½•](#é™„å½•)

---

## æ¦‚è¿°

### 1.1 æ–‡æ¡£ç›®çš„

æœ¬æ–‡æ¡£æ—¨åœ¨ä¸ºæ¡£æ¡ˆç®¡ç†ç³»ç»Ÿçš„å¼€å‘å›¢é˜Ÿæä¾›ç»Ÿä¸€çš„æµ‹è¯•è§„èŒƒå’Œæœ€ä½³å®è·µæŒ‡å—ï¼Œç¡®ä¿ï¼š
- ä»£ç è´¨é‡ç¨³å®šå¯é 
- æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡
- æµ‹è¯•ä»£ç å¯ç»´æŠ¤æ€§é«˜
- å›¢é˜Ÿåä½œæ•ˆç‡æå‡

### 1.2 é€‚ç”¨èŒƒå›´

æœ¬è§„èŒƒé€‚ç”¨äºæ¡£æ¡ˆç®¡ç†ç³»ç»Ÿçš„æ‰€æœ‰æµ‹è¯•ä»£ç ï¼ŒåŒ…æ‹¬ï¼š
- åç«¯å•å…ƒæµ‹è¯•ï¼ˆJUnit 5 + Mockitoï¼‰
- åç«¯é›†æˆæµ‹è¯•ï¼ˆSpring Boot Test + H2ï¼‰
- å‰ç«¯å•å…ƒæµ‹è¯•ï¼ˆVitest + Vue Test Utilsï¼‰
- å‰ç«¯ç»„ä»¶æµ‹è¯•
- E2Eæµ‹è¯•ï¼ˆPlaywrightï¼Œå¯é€‰ï¼‰

### 1.3 æµ‹è¯•é‡‘å­—å¡”åŸåˆ™

æˆ‘ä»¬éµå¾ªæµ‹è¯•é‡‘å­—å¡”åŸåˆ™ï¼Œæµ‹è¯•ç±»å‹åˆ†å¸ƒå¦‚ä¸‹ï¼š

```
        /\
       /  \      E2Eæµ‹è¯• (10%)
      /____\     
     /      \    é›†æˆæµ‹è¯• (20%)
    /________\   
   /          \  å•å…ƒæµ‹è¯• (70%)
  /____________\ 
```

- **å•å…ƒæµ‹è¯• (70%)**ï¼šå¿«é€Ÿã€ç‹¬ç«‹ã€é’ˆå¯¹å•ä¸ªå‡½æ•°/ç±»
- **é›†æˆæµ‹è¯• (20%)**ï¼šæµ‹è¯•æ¨¡å—é—´äº¤äº’ã€æ•°æ®åº“æ“ä½œ
- **E2Eæµ‹è¯• (10%)**ï¼šç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹éªŒè¯

---

## æµ‹è¯•ç­–ç•¥

### 2.1 æµ‹è¯•ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | æˆªæ­¢æ—¥æœŸ |
|------|--------|--------|----------|
| åç«¯ä»£ç è¦†ç›–ç‡ | â‰¥80% | å¾…æµ‹é‡ | ç¬¬5å‘¨æœ« |
| å‰ç«¯ä»£ç è¦†ç›–ç‡ | â‰¥70% | 0% | ç¬¬5å‘¨æœ« |
| å•å…ƒæµ‹è¯•é€šè¿‡ç‡ | 100% | 100% | æŒç»­ |
| é›†æˆæµ‹è¯•é€šè¿‡ç‡ | 100% | å¾…æµ‹é‡ | ç¬¬3å‘¨æœ« |
| æµ‹è¯•æ‰§è¡Œæ—¶é—´ | <5åˆ†é’Ÿ | å¾…æµ‹é‡ | ç¬¬4å‘¨æœ« |

### 2.2 æµ‹è¯•åˆ†å±‚ç­–ç•¥

#### 2.2.1 åç«¯æµ‹è¯•åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  E2Eæµ‹è¯• (å¯é€‰)                      â”‚
â”‚  - APIç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é›†æˆæµ‹è¯•                            â”‚
â”‚  - Controllerå±‚æµ‹è¯•                  â”‚
â”‚  - Serviceå±‚é›†æˆæµ‹è¯•                 â”‚
â”‚  - Repositoryå±‚æµ‹è¯•                  â”‚
â”‚  - æ¶ˆæ¯é˜Ÿåˆ—é›†æˆæµ‹è¯•                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•å…ƒæµ‹è¯•                            â”‚
â”‚  - Serviceä¸šåŠ¡é€»è¾‘æµ‹è¯•               â”‚
â”‚  - Utilå·¥å…·ç±»æµ‹è¯•                    â”‚
â”‚  - ValidatoréªŒè¯å™¨æµ‹è¯•               â”‚
â”‚  - Mapperè½¬æ¢å™¨æµ‹è¯•                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.2 å‰ç«¯æµ‹è¯•åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  E2Eæµ‹è¯• (Playwright)                â”‚
â”‚  - ç”¨æˆ·ç™»å½•æµç¨‹                      â”‚
â”‚  - æ¡£æ¡ˆå€Ÿé˜…æµç¨‹                      â”‚
â”‚  - æƒé™ç®¡ç†æµç¨‹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»„ä»¶æµ‹è¯•                            â”‚
â”‚  - ä¸šåŠ¡ç»„ä»¶æµ‹è¯•                      â”‚
â”‚  - é€šç”¨ç»„ä»¶æµ‹è¯•                      â”‚
â”‚  - è¡¨å•äº¤äº’æµ‹è¯•                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•å…ƒæµ‹è¯•                            â”‚
â”‚  - StoreçŠ¶æ€ç®¡ç†æµ‹è¯•                 â”‚
â”‚  - Composableé€»è¾‘æµ‹è¯•                â”‚
â”‚  - Utilså·¥å…·å‡½æ•°æµ‹è¯•                 â”‚
â”‚  - APIæ¨¡å—æµ‹è¯•                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æµ‹è¯•ä¼˜å…ˆçº§

#### P0 - å¿…é¡»æµ‹è¯•ï¼ˆç¬¬1-3å‘¨ï¼‰
- âœ… æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆæ¡£æ¡ˆCRUDã€å€Ÿé˜…å½’è¿˜ï¼‰
- âœ… æƒé™éªŒè¯å’Œå®‰å…¨ç›¸å…³
- âœ… æ•°æ®æŒä¹…åŒ–æ“ä½œ
- âœ… å…³é”®å·¥å…·å‡½æ•°

#### P1 - åº”è¯¥æµ‹è¯•ï¼ˆç¬¬4-5å‘¨ï¼‰
- ğŸ“‹ æ¬¡è¦ä¸šåŠ¡é€»è¾‘
- ğŸ“‹ UIç»„ä»¶äº¤äº’
- ğŸ“‹ çŠ¶æ€ç®¡ç†
- ğŸ“‹ APIè°ƒç”¨

#### P2 - å¯ä»¥æµ‹è¯•ï¼ˆç¬¬6-8å‘¨ï¼‰
- ğŸ“‹ è¾¹ç•Œæƒ…å†µ
- ğŸ“‹ æ€§èƒ½æµ‹è¯•
- ğŸ“‹ å…¼å®¹æ€§æµ‹è¯•

---

## åç«¯æµ‹è¯•è§„èŒƒ

### 3.1 æŠ€æœ¯æ ˆ

- **æµ‹è¯•æ¡†æ¶**: JUnit 5 (Jupiter)
- **Mockæ¡†æ¶**: Mockito
- **æ–­è¨€åº“**: AssertJ + JUnit Assertions
- **è¦†ç›–ç‡å·¥å…·**: JaCoCo
- **æµ‹è¯•æ•°æ®åº“**: H2 (å†…å­˜æ•°æ®åº“)
- **Springæµ‹è¯•**: Spring Boot Test

### 3.2 é¡¹ç›®ç»“æ„

```
src/test/java/com/archive/management/
â”œâ”€â”€ BaseTest.java                    # æµ‹è¯•åŸºç±»
â”œâ”€â”€ BaseIntegrationTest.java         # é›†æˆæµ‹è¯•åŸºç±»
â”œâ”€â”€ TestDataFactory.java             # æµ‹è¯•æ•°æ®å·¥å‚
â”œâ”€â”€ config/                          # æµ‹è¯•é…ç½®
â”‚   â””â”€â”€ TestConfig.java
â”œâ”€â”€ controller/                      # Controlleræµ‹è¯•
â”‚   â”œâ”€â”€ ArchiveControllerTest.java
â”‚   â””â”€â”€ UserControllerTest.java
â”œâ”€â”€ service/                         # Serviceå•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ ArchiveServiceTest.java
â”‚   â””â”€â”€ UserServiceTest.java
â”œâ”€â”€ integration/                     # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ ArchiveIntegrationTest.java
â”‚   â””â”€â”€ BorrowIntegrationTest.java
â”œâ”€â”€ repository/                      # Repositoryæµ‹è¯•
â”‚   â””â”€â”€ ArchiveRepositoryTest.java
â””â”€â”€ util/                           # å·¥å…·ç±»æµ‹è¯•
    â””â”€â”€ DateUtilTest.java
```

### 3.3 æµ‹è¯•åŸºç±»ä½¿ç”¨

#### 3.3.1 BaseTest - é€šç”¨æµ‹è¯•åŸºç±»

æ‰€æœ‰æµ‹è¯•ç±»éƒ½åº”ç»§æ‰¿ `BaseTest`ï¼Œå®ƒæä¾›ï¼š

```java
@ExtendWith(SpringExtension.class)
@SpringBootTest
@ActiveProfiles("test")
@Transactional
@AutoConfigureTestEntityManager
@TestPropertySource(properties = {
    "spring.jpa.show-sql=false",
    "logging.level.org.hibernate.SQL=WARN"
})
public abstract class BaseTest {
    
    @Autowired
    protected TestEntityManager entityManager;
    
    // æµ‹è¯•æ•°æ®å‡†å¤‡æ–¹æ³•
    protected Department createTestDepartment(String name) { ... }
    protected Role createTestRole(String name) { ... }
    protected User createTestUser(String username) { ... }
    protected Archive createTestArchive(String title) { ... }
    
    // æµ‹è¯•æ•°æ®æ¸…ç†æ–¹æ³•
    @AfterEach
    public void cleanup() { ... }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```java
@DisplayName("æ¡£æ¡ˆæœåŠ¡æµ‹è¯•")
class ArchiveServiceTest extends BaseTest {
    
    @Autowired
    private ArchiveService archiveService;
    
    @Test
    @DisplayName("åº”è¯¥æˆåŠŸåˆ›å»ºæ¡£æ¡ˆ")
    void shouldCreateArchive() {
        // Given
        Archive archive = createTestArchive("æµ‹è¯•æ¡£æ¡ˆ");
        
        // When
        Archive saved = archiveService.create(archive);
        
        // Then
        assertThat(saved.getId()).isNotNull();
        assertThat(saved.getTitle()).isEqualTo("æµ‹è¯•æ¡£æ¡ˆ");
    }
}
```

### 3.4 å•å…ƒæµ‹è¯•è§„èŒƒ

#### 3.4.1 Serviceå±‚æµ‹è¯•

**æµ‹è¯•é‡ç‚¹**ï¼š
- ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§
- å¼‚å¸¸å¤„ç†
- è¾¹ç•Œæ¡ä»¶
- æƒé™éªŒè¯

**ç¤ºä¾‹**ï¼š

```java
@DisplayName("æ¡£æ¡ˆæœåŠ¡å•å…ƒæµ‹è¯•")
class ArchiveServiceTest extends BaseTest {
    
    @Autowired
    private ArchiveService archiveService;
    
    @MockBean
    private ArchiveRepository archiveRepository;
    
    @MockBean
    private UserService userService;
    
    @Test
    @DisplayName("åˆ›å»ºæ¡£æ¡ˆ - æˆåŠŸåœºæ™¯")
    void createArchive_Success() {
        // Given: å‡†å¤‡æµ‹è¯•æ•°æ®
        ArchiveCreateDTO dto = ArchiveCreateDTO.builder()
            .title("æµ‹è¯•æ¡£æ¡ˆ")
            .categoryId(1L)
            .content("æ¡£æ¡ˆå†…å®¹")
            .build();
        
        User currentUser = createTestUser("testuser");
        when(userService.getCurrentUser()).thenReturn(currentUser);
        
        Archive expectedArchive = new Archive();
        expectedArchive.setId(1L);
        expectedArchive.setTitle(dto.getTitle());
        when(archiveRepository.save(any(Archive.class))).thenReturn(expectedArchive);
        
        // When: æ‰§è¡Œæµ‹è¯•æ–¹æ³•
        Archive result = archiveService.create(dto);
        
        // Then: éªŒè¯ç»“æœ
        assertThat(result).isNotNull();
        assertThat(result.getId()).isEqualTo(1L);
        assertThat(result.getTitle()).isEqualTo("æµ‹è¯•æ¡£æ¡ˆ");
        
        // éªŒè¯æ–¹æ³•è°ƒç”¨
        verify(archiveRepository, times(1)).save(any(Archive.class));
        verify(userService, times(1)).getCurrentUser();
    }
    
    @Test
    @DisplayName("åˆ›å»ºæ¡£æ¡ˆ - æ ‡é¢˜ä¸ºç©ºåº”æŠ›å‡ºå¼‚å¸¸")
    void createArchive_EmptyTitle_ShouldThrowException() {
        // Given
        ArchiveCreateDTO dto = ArchiveCreateDTO.builder()
            .title("")
            .categoryId(1L)
            .build();
        
        // When & Then
        assertThatThrownBy(() -> archiveService.create(dto))
            .isInstanceOf(ValidationException.class)
            .hasMessageContaining("æ ‡é¢˜ä¸èƒ½ä¸ºç©º");
    }
    
    @Test
    @DisplayName("åˆ é™¤æ¡£æ¡ˆ - æ— æƒé™åº”æŠ›å‡ºå¼‚å¸¸")
    void deleteArchive_NoPermission_ShouldThrowException() {
        // Given
        Archive archive = createTestArchive("æµ‹è¯•æ¡£æ¡ˆ");
        User currentUser = createTestUser("otheruser");
        
        when(archiveRepository.findById(1L)).thenReturn(Optional.of(archive));
        when(userService.getCurrentUser()).thenReturn(currentUser);
        when(userService.hasPermission(currentUser, "archive:delete")).thenReturn(false);
        
        // When & Then
        assertThatThrownBy(() -> archiveService.delete(1L))
            .isInstanceOf(PermissionDeniedException.class)
            .hasMessageContaining("æ— æƒé™åˆ é™¤æ¡£æ¡ˆ");
    }
}
```

#### 3.4.2 Utilå·¥å…·ç±»æµ‹è¯•

**æµ‹è¯•é‡ç‚¹**ï¼š
- å„ç§è¾“å…¥æƒ…å†µ
- è¾¹ç•Œå€¼
- å¼‚å¸¸æƒ…å†µ
- nullå¤„ç†

**ç¤ºä¾‹**ï¼š

```java
@DisplayName("æ—¥æœŸå·¥å…·ç±»æµ‹è¯•")
class DateUtilTest {
    
    @Test
    @DisplayName("æ ¼å¼åŒ–æ—¥æœŸ - æ ‡å‡†æ ¼å¼")
    void formatDate_StandardFormat() {
        // Given
        LocalDateTime date = LocalDateTime.of(2024, 1, 15, 10, 30, 0);
        
        // When
        String result = DateUtil.format(date, "yyyy-MM-dd HH:mm:ss");
        
        // Then
        assertThat(result).isEqualTo("2024-01-15 10:30:00");
    }
    
    @Test
    @DisplayName("æ ¼å¼åŒ–æ—¥æœŸ - nullåº”è¿”å›ç©ºå­—ç¬¦ä¸²")
    void formatDate_Null_ShouldReturnEmpty() {
        // When
        String result = DateUtil.format(null, "yyyy-MM-dd");
        
        // Then
        assertThat(result).isEmpty();
    }
    
    @ParameterizedTest
    @DisplayName("è§£ææ—¥æœŸ - å¤šç§æ ¼å¼")
    @CsvSource({
        "2024-01-15, yyyy-MM-dd",
        "2024/01/15, yyyy/MM/dd",
        "20240115, yyyyMMdd"
    })
    void parseDate_VariousFormats(String dateStr, String pattern) {
        // When
        LocalDate result = DateUtil.parse(dateStr, pattern);
        
        // Then
        assertThat(result).isEqualTo(LocalDate.of(2024, 1, 15));
    }
}
```

### 3.5 é›†æˆæµ‹è¯•è§„èŒƒ

#### 3.5.1 Controllerå±‚æµ‹è¯•

**æµ‹è¯•é‡ç‚¹**ï¼š
- HTTPè¯·æ±‚/å“åº”
- å‚æ•°éªŒè¯
- æƒé™æ§åˆ¶
- å¼‚å¸¸å¤„ç†

**ç¤ºä¾‹**ï¼š

```java
@DisplayName("æ¡£æ¡ˆæ§åˆ¶å™¨é›†æˆæµ‹è¯•")
@WebMvcTest(ArchiveController.class)
class ArchiveControllerTest extends BaseTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private ArchiveService archiveService;
    
    @Test
    @DisplayName("GET /api/archives/{id} - æˆåŠŸè·å–æ¡£æ¡ˆ")
    @WithMockUser(username = "testuser", roles = {"USER"})
    void getArchive_Success() throws Exception {
        // Given
        Archive archive = createTestArchive("æµ‹è¯•æ¡£æ¡ˆ");
        archive.setId(1L);
        when(archiveService.findById(1L)).thenReturn(archive);
        
        // When & Then
        mockMvc.perform(get("/api/archives/1")
                .contentType(MediaType.APPLICATION_JSON))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.code").value(200))
            .andExpect(jsonPath("$.data.id").value(1))
            .andExpect(jsonPath("$.data.title").value("æµ‹è¯•æ¡£æ¡ˆ"))
            .andDo(print());
    }
    
    @Test
    @DisplayName("POST /api/archives - åˆ›å»ºæ¡£æ¡ˆæˆåŠŸ")
    @WithMockUser(username = "testuser", roles = {"ADMIN"})
    void createArchive_Success() throws Exception {
        // Given
        ArchiveCreateDTO dto = ArchiveCreateDTO.builder()
            .title("æ–°æ¡£æ¡ˆ")
            .categoryId(1L)
            .content("æ¡£æ¡ˆå†…å®¹")
            .build();
        
        Archive savedArchive = new Archive();
        savedArchive.setId(1L);
        savedArchive.setTitle(dto.getTitle());
        
        when(archiveService.create(any(ArchiveCreateDTO.class))).thenReturn(savedArchive);
        
        // When & Then
        mockMvc.perform(post("/api/archives")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(dto)))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.code").value(200))
            .andExpect(jsonPath("$.data.id").value(1))
            .andDo(print());
    }
    
    @Test
    @DisplayName("POST /api/archives - æ ‡é¢˜ä¸ºç©ºåº”è¿”å›400")
    @WithMockUser(username = "testuser", roles = {"ADMIN"})
    void createArchive_EmptyTitle_ShouldReturn400() throws Exception {
        // Given
        ArchiveCreateDTO dto = ArchiveCreateDTO.builder()
            .title("")  // ç©ºæ ‡é¢˜
            .categoryId(1L)
            .build();
        
        // When & Then
        mockMvc.perform(post("/api/archives")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(dto)))
            .andExpect(status().isBadRequest())
            .andExpect(jsonPath("$.code").value(400))
            .andDo(print());
    }
}
```

#### 3.5.2 Repositoryå±‚æµ‹è¯•

**æµ‹è¯•é‡ç‚¹**ï¼š
- CRUDæ“ä½œ
- è‡ªå®šä¹‰æŸ¥è¯¢
- åˆ†é¡µæ’åº
- äº‹åŠ¡å¤„ç†

**ç¤ºä¾‹**ï¼š

```java
@DisplayName("æ¡£æ¡ˆRepositoryæµ‹è¯•")
@DataJpaTest
class ArchiveRepositoryTest extends BaseTest {
    
    @Autowired
    private ArchiveRepository archiveRepository;
    
    @Test
    @DisplayName("ä¿å­˜å¹¶æŸ¥è¯¢æ¡£æ¡ˆ")
    void saveAndFindArchive() {
        // Given
        Archive archive = createTestArchive("æµ‹è¯•æ¡£æ¡ˆ");
        
        // When
        Archive saved = archiveRepository.save(archive);
        Archive found = archiveRepository.findById(saved.getId()).orElse(null);
        
        // Then
        assertThat(found).isNotNull();
        assertThat(found.getTitle()).isEqualTo("æµ‹è¯•æ¡£æ¡ˆ");
    }
    
    @Test
    @DisplayName("æ ¹æ®åˆ†ç±»æŸ¥è¯¢æ¡£æ¡ˆ")
    void findByCategoryId() {
        // Given
        Archive archive1 = createTestArchive("æ¡£æ¡ˆ1");
        archive1.setCategoryId(1L);
        Archive archive2 = createTestArchive("æ¡£æ¡ˆ2");
        archive2.setCategoryId(1L);
        Archive archive3 = createTestArchive("æ¡£æ¡ˆ3");
        archive3.setCategoryId(2L);
        
        archiveRepository.saveAll(List.of(archive1, archive2, archive3));
        
        // When
        List<Archive> result = archiveRepository.findByCategoryId(1L);
        
        // Then
        assertThat(result).hasSize(2);
        assertThat(result).extracting(Archive::getTitle)
            .containsExactlyInAnyOrder("æ¡£æ¡ˆ1", "æ¡£æ¡ˆ2");
    }
    
    @Test
    @DisplayName("åˆ†é¡µæŸ¥è¯¢æ¡£æ¡ˆ")
    void findAllWithPagination() {
        // Given
        for (int i = 1; i <= 15; i++) {
            Archive archive = createTestArchive("æ¡£æ¡ˆ" + i);
            archiveRepository.save(archive);
        }
        
        // When
        Pageable pageable = PageRequest.of(0, 10, Sort.by("createTime").descending());
        Page<Archive> page = archiveRepository.findAll(pageable);
        
        // Then
        assertThat(page.getTotalElements()).isEqualTo(15);
        assertThat(page.getTotalPages()).isEqualTo(2);
        assertThat(page.getContent()).hasSize(10);
    }
}
```

### 3.6 æµ‹è¯•é…ç½®

#### 3.6.1 application-test.yml

```yaml
spring:
  datasource:
    driver-class-name: org.h2.Driver
    url: jdbc:h2:mem:testdb;MODE=MySQL;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    username: sa
    password:
  
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.H2Dialect
  
  # ç¦ç”¨RabbitMQ
  rabbitmq:
    host: localhost
    port: 5672
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration
  
  # ä½¿ç”¨ç®€å•ç¼“å­˜
  cache:
    type: simple

# æ—¥å¿—é…ç½®
logging:
  level:
    com.archive.management: DEBUG
    org.springframework.test: INFO
    org.hibernate.SQL: WARN
```

#### 3.6.2 JaCoCoé…ç½® (pom.xml)

```xml
<plugin>
    <groupId>org.jacoco</groupId>
    <artifactId>jacoco-maven-plugin</artifactId>
    <version>0.8.8</version>
    <executions>
        <execution>
            <goals>
                <goal>prepare-agent</goal>
            </goals>
        </execution>
        <execution>
            <id>report</id>
            <phase>test</phase>
            <goals>
                <goal>report</goal>
            </goals>
        </execution>
        <execution>
            <id>jacoco-check</id>
            <goals>
                <goal>check</goal>
            </goals>
            <configuration>
                <rules>
                    <rule>
                        <element>PACKAGE</element>
                        <limits>
                            <limit>
                                <counter>LINE</counter>
                                <value>COVEREDRATIO</value>
                                <minimum>0.80</minimum>
                            </limit>
                        </limits>
                    </rule>
                </rules>
            </configuration>
        </execution>
    </executions>
</plugin>
```

---

## å‰ç«¯æµ‹è¯•è§„èŒƒ

### 4.1 æŠ€æœ¯æ ˆ

- **æµ‹è¯•æ¡†æ¶**: Vitest
- **ç»„ä»¶æµ‹è¯•**: Vue Test Utils
- **DOMç¯å¢ƒ**: happy-dom
- **è¦†ç›–ç‡å·¥å…·**: @vitest/coverage-v8
- **æ–­è¨€åº“**: Vitestå†…ç½® + Chai

### 4.2 é¡¹ç›®ç»“æ„

```
frontend/src/
â”œâ”€â”€ test-utils/                      # æµ‹è¯•è¾…åŠ©å·¥å…·
â”‚   â”œâ”€â”€ index.ts                     # é€šç”¨æµ‹è¯•å·¥å…·
â”‚   â””â”€â”€ mocks.ts                     # Mockå·¥å…·
â”œâ”€â”€ utils/__tests__/                 # å·¥å…·å‡½æ•°æµ‹è¯•
â”‚   â”œâ”€â”€ formatter.spec.ts
â”‚   â”œâ”€â”€ date.spec.ts
â”‚   â””â”€â”€ validation.spec.ts
â”œâ”€â”€ stores/__tests__/                # Storeæµ‹è¯•
â”‚   â”œâ”€â”€ user.spec.ts
â”‚   â”œâ”€â”€ auth.spec.ts
â”‚   â””â”€â”€ app.spec.ts
â”œâ”€â”€ components/__tests__/            # ç»„ä»¶æµ‹è¯•
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”œâ”€â”€ DataTable.spec.ts
â”‚   â”‚   â””â”€â”€ SearchBox.spec.ts
â”‚   â””â”€â”€ business/
â”‚       â”œâ”€â”€ ArchiveForm.spec.ts
â”‚       â””â”€â”€ BorrowList.spec.ts
â”œâ”€â”€ composables/__tests__/           # Composableæµ‹è¯•
â”‚   â”œâ”€â”€ usePermission.spec.ts
â”‚   â””â”€â”€ useExport.spec.ts
â””â”€â”€ api/__tests__/                   # APIæ¨¡å—æµ‹è¯•
    â”œâ”€â”€ archive.spec.ts
    â””â”€â”€ user.spec.ts
```

### 4.3 æµ‹è¯•è¾…åŠ©å·¥å…·

#### 4.3.1 test-utils/index.ts

```typescript
import { mount, VueWrapper } from '@vue/test-utils'
import type { ComponentPublicInstance } from 'vue'
import ElementPlus from 'element-plus'
import { createPinia } from 'pinia'

/**
 * æŒ‚è½½ç»„ä»¶çš„è¾…åŠ©å‡½æ•°
 * è‡ªåŠ¨æ³¨å†ŒElement Pluså’ŒPinia
 */
export function mountWithPlugins(component: any, options: any = {}) {
  const pinia = createPinia()
  
  return mount(component, {
    global: {
      plugins: [ElementPlus, pinia],
      stubs: {
        teleport: true,
        transition: false
      },
      ...options.global
    },
    ...options
  })
}

/**
 * ç­‰å¾…å¼‚æ­¥æ›´æ–°
 */
export async function flushPromises() {
  return new Promise((resolve) => setTimeout(resolve, 0))
}

/**
 * æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥
 */
export async function setInputValue(
  wrapper: VueWrapper<ComponentPublicInstance>,
  selector: string,
  value: string
) {
  const input = wrapper.find(selector)
  await input.setValue(value)
  await wrapper.vm.$nextTick()
}

/**
 * æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»
 */
export async function clickButton(
  wrapper: VueWrapper<ComponentPublicInstance>,
  selector: string
) {
  const button = wrapper.find(selector)
  await button.trigger('click')
  await wrapper.vm.$nextTick()
}
```

#### 4.3.2 test-utils/mocks.ts

```typescript
import { vi } from 'vitest'

/**
 * æ¨¡æ‹ŸlocalStorage
 */
export const mockLocalStorage = () => {
  const storage: Record<string, string> = {}
  
  return {
    getItem: vi.fn((key: string) => storage[key] || null),
    setItem: vi.fn((key: string, value: string) => {
      storage[key] = value
    }),
    removeItem: vi.fn((key: string) => {
      delete storage[key]
    }),
    clear: vi.fn(() => {
      Object.keys(storage).forEach(key => delete storage[key])
    })
  }
}

/**
 * æ¨¡æ‹Ÿaxiosè¯·æ±‚
 */
export const mockAxios = () => {
  return {
    get: vi.fn(),
    post: vi.fn(),
    put: vi.fn(),
    delete: vi.fn(),
    request: vi.fn()
  }
}

/**
 * æ¨¡æ‹Ÿè·¯ç”±
 */
export const mockRouter = () => {
  return {
    push: vi.fn(),
    replace: vi.fn(),
    go: vi.fn(),
    back: vi.fn(),
    currentRoute: { value: { path: '/', query: {}, params: {} } }
  }
}

/**
 * æ¨¡æ‹ŸElement Plusæ¶ˆæ¯æç¤º
 */
export const mockElMessage = () => {
  return {
    success: vi.fn(),
    error: vi.fn(),
    warning: vi.fn(),
    info: vi.fn()
  }
}
```

### 4.4 å•å…ƒæµ‹è¯•è§„èŒƒ

#### 4.4.1 å·¥å…·å‡½æ•°æµ‹è¯•

**ç¤ºä¾‹**ï¼š

```typescript
import { describe, it, expect } from 'vitest'
import { formatDate, formatFileSize, formatNumber } from '@/utils/formatter'

describe('formatterå·¥å…·å‡½æ•°', () => {
  describe('formatDate', () => {
    it('åº”è¯¥æ­£ç¡®æ ¼å¼åŒ–æ—¥æœŸ', () => {
      const date = new Date('2024-01-15T10:30:00Z')
      expect(formatDate(date, 'YYYY-MM-DD')).toBe('2024-01-15')
    })

    it('åº”è¯¥å¤„ç†nullå€¼', () => {
      expect(formatDate(null)).toBe('')
    })

    it('åº”è¯¥æ”¯æŒè‡ªå®šä¹‰æ ¼å¼', () => {
      const date = new Date('2024-01-15T10:30:00Z')
      expect(formatDate(date, 'YYYYå¹´MMæœˆDDæ—¥')).toBe('2024å¹´01æœˆ15æ—¥')
    })
  })

  describe('formatFileSize', () => {
    it('åº”è¯¥æ­£ç¡®æ ¼å¼åŒ–å­—èŠ‚', () => {
      expect(formatFileSize(0)).toBe('0 B')
      expect(formatFileSize(1024)).toBe('1 KB')
      expect(formatFileSize(1048576)).toBe('1 MB')
      expect(formatFileSize(1073741824)).toBe('1 GB')
    })

    it('åº”è¯¥ä¿ç•™ä¸¤ä½å°æ•°', () => {
      expect(formatFileSize(1536)).toBe('1.50 KB')
      expect(formatFileSize(2621440)).toBe('2.50 MB')
    })
  })

  describe('formatNumber', () => {
    it('åº”è¯¥æ·»åŠ åƒåˆ†ä½åˆ†éš”ç¬¦', () => {
      expect(formatNumber(1000)).toBe('1,000')
      expect(formatNumber(1000000)).toBe('1,000,000')
    })

    it('åº”è¯¥å¤„ç†å°æ•°', () => {
      expect(formatNumber(1234.56)).toBe('1,234.56')
    })
  })
})
```

#### 4.4.2 Storeæµ‹è¯•

**ç¤ºä¾‹**ï¼š

```typescript
import { describe, it, expect, beforeEach } from 'vitest'
import { setActivePinia, createPinia } from 'pinia'
import { useUserStore } from '@/stores/user'

describe('User Store', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
  })

  describe('çŠ¶æ€ç®¡ç†', () => {
    it('åº”è¯¥æœ‰æ­£ç¡®çš„åˆå§‹çŠ¶æ€', () => {
      const store = useUserStore()
      
      expect(store.username).toBe('')
      expect(store.isLoggedIn).toBe(false)
      expect(store.userId).toBeNull()
      expect(store.roles).toEqual([])
    })

    it('åº”è¯¥èƒ½å¤Ÿæ›´æ–°ç”¨æˆ·ä¿¡æ¯', () => {
      const store = useUserStore()
      
      store.setUser({
        id: 1,
        username: 'testuser',
        roles: ['ADMIN']
      })
      
      expect(store.userId).toBe(1)
      expect(store.username).toBe('testuser')
      expect(store.roles).toEqual(['ADMIN'])
      expect(store.isLoggedIn).toBe(true)
    })
  })

  describe('Actions', () => {
    it('ç™»å½•åº”è¯¥æ›´æ–°çŠ¶æ€', async () => {
      const store = useUserStore()
      
      await store.login('testuser', 'password123')
      
      expect(store.isLoggedIn).toBe(true)
      expect(store.username).toBe('testuser')
    })

    it('ç™»å‡ºåº”è¯¥æ¸…ç©ºçŠ¶æ€', async () => {
      const store = useUserStore()
      
      // å…ˆç™»å½•
      await store.login('testuser', 'password123')
      expect(store.isLoggedIn).toBe(true)
      
      // å†ç™»å‡º
      await store.logout()
      
      expect(store.isLoggedIn).toBe(false)
      expect(store.username).toBe('')
      expect(store.userId).toBeNull()
    })
  })

  describe('Getters', () => {
    it('displayNameåº”è¯¥è¿”å›æ­£ç¡®çš„æ˜¾ç¤ºåç§°', () => {
      const store = useUserStore()
      
      // æœªç™»å½•æ—¶
      expect(store.displayName).toBe('æ¸¸å®¢')
      
      // ç™»å½•å
      store.setUser({ id: 1, username: 'testuser', roles: [] })
      expect(store.displayName).toBe('testuser')
    })

    it('hasRoleåº”è¯¥æ­£ç¡®åˆ¤æ–­è§’è‰²', () => {
      const store = useUserStore()
      store.setUser({ id: 1, username: 'testuser', roles: ['ADMIN', 'USER'] })
      
      expect(store.hasRole('ADMIN')).toBe(true)
      expect(store.hasRole('USER')).toBe(true)
      expect(store.hasRole('GUEST')).toBe(false)
    })
  })
})
```

### 4.5 ç»„ä»¶æµ‹è¯•è§„èŒƒ

#### 4.5.1 é€šç”¨ç»„ä»¶æµ‹è¯•

**ç¤ºä¾‹ - DataTableç»„ä»¶**ï¼š

```typescript
import { describe, it, expect, vi } from 'vitest'
import { mountWithPlugins } from '@/test-utils'
import DataTable from '@/components/common/DataTable.vue'

describe('DataTableç»„ä»¶', () => {
  const mockData = [
    { id: 1, name: 'å¼ ä¸‰', age: 25 },
    { id: 2, name: 'æå››', age: 30 }
  ]

  const mockColumns = [
    { prop: 'id', label: 'ID', width: 80 },
    { prop: 'name', label: 'å§“å', width: 120 },
    { prop: 'age', label: 'å¹´é¾„', width: 100 }
  ]

  it('åº”è¯¥æ­£ç¡®æ¸²æŸ“è¡¨æ ¼æ•°æ®', () => {
    const wrapper = mountWithPlugins(DataTable, {
      props: {
        data: mockData,
        columns: mockColumns
      }
    })

    expect(wrapper.find('.el-table').exists()).toBe(true)
    expect(wrapper.text()).toContain('å¼ ä¸‰')
    expect(wrapper.text()).toContain('æå››')
  })

  it('åº”è¯¥æ”¯æŒåˆ†é¡µ', async () => {
    const onPageChange = vi.fn()
    
    const wrapper = mountWithPlugins(DataTable, {
      props: {
        data: mockData,
        columns: mockColumns,
        pagination: {
          total: 100,
          pageSize: 10,
          currentPage: 1
        },
        onPageChange
      }
    })

    expect(wrapper.find('.el-pagination').exists()).toBe(true)
    
    // æ¨¡æ‹Ÿç¿»é¡µ
    await wrapper.find('.el-pagination .btn-next').trigger('click')
    expect(onPageChange).toHaveBeenCalledWith(2)
  })

  it('åº”è¯¥æ”¯æŒè¡Œé€‰æ‹©', async () => {
    const onSelectionChange = vi.fn()
    
    const wrapper = mountWithPlugins(DataTable, {
      props: {
        data: mockData,
        columns: mockColumns,
        selectable: true,
        onSelectionChange
      }
    })

    // æ¨¡æ‹Ÿé€‰æ‹©è¡Œ
    const checkbox = wrapper.find('.el-table__row:first-child .el-checkbox')
    await checkbox.trigger('click')
    
    expect(onSelectionChange).toHaveBeenCalled()
  })

  it('åº”è¯¥æ”¯æŒè‡ªå®šä¹‰æ“ä½œåˆ—', () => {
    const wrapper = mountWithPlugins(DataTable, {
      props: {
        data: mockData,
        columns: mockColumns
      },
      slots: {
        actions: '<button class="edit-btn">ç¼–è¾‘</button>'
      }
    })

    expect(wrapper.find('.edit-btn').exists()).toBe(true)
  })
})
```

#### 4.5.2 ä¸šåŠ¡ç»„ä»¶æµ‹è¯•

**ç¤ºä¾‹ - ArchiveFormç»„ä»¶**ï¼š

```typescript
import { describe, it, expect, vi, beforeEach } from 'vitest'
import { mountWithPlugins, setInputValue, clickButton } from '@/test-utils'
import ArchiveForm from '@/components/business/ArchiveForm.vue'
import * as archiveApi from '@/api/modules/archive'

vi.mock('@/api/modules/archive')

describe('ArchiveFormç»„ä»¶', () => {
  beforeEach(() => {
    vi.clearAllMocks()
  })

  it('åº”è¯¥æ­£ç¡®æ¸²æŸ“è¡¨å•', () => {
    const wrapper = mountWithPlugins(ArchiveForm, {
      props: {
        visible: true
      }
    })

    expect(wrapper.find('.archive-form').exists()).toBe(true)
    expect(wrapper.find('input[placeholder="è¯·è¾“å…¥æ¡£æ¡ˆæ ‡é¢˜"]').exists()).toBe(true)
    expect(wrapper.find('textarea[placeholder="è¯·è¾“å…¥æ¡£æ¡ˆå†…å®¹"]').exists()).toBe(true)
  })

  it('åº”è¯¥éªŒè¯å¿…å¡«å­—æ®µ', async () => {
    const wrapper = mountWithPlugins(ArchiveForm, {
      props: {
        visible: true
      }
    })

    // ä¸å¡«å†™ä»»ä½•å†…å®¹ï¼Œç›´æ¥æäº¤
    await clickButton(wrapper, '.submit-btn')

    // åº”è¯¥æ˜¾ç¤ºéªŒè¯é”™è¯¯
    expect(wrapper.text()).toContain('è¯·è¾“å…¥æ¡£æ¡ˆæ ‡é¢˜')
  })

  it('åº”è¯¥æˆåŠŸæäº¤è¡¨å•', async () => {
    const mockCreate = vi.fn().mockResolvedValue({ id: 1 })
    vi.mocked(archiveApi.createArchive).mockImplementation(mockCreate)

    const onSuccess = vi.fn()
    
    const wrapper = mountWithPlugins(ArchiveForm, {
      props: {
        visible: true,
        onSuccess
      }
    })

    // å¡«å†™è¡¨å•
    await setInputValue(wrapper, 'input[placeholder="è¯·è¾“å…¥æ¡£æ¡ˆæ ‡é¢˜"]', 'æµ‹è¯•æ¡£æ¡ˆ')
    await setInputValue(wrapper, 'textarea[placeholder="è¯·è¾“å…¥æ¡£æ¡ˆå†…å®¹"]', 'æ¡£æ¡ˆå†…å®¹')

    // æäº¤
    await clickButton(wrapper, '.submit-btn')
    await flushPromises()

    // éªŒè¯APIè°ƒç”¨
    expect(mockCreate).toHaveBeenCalledWith({
      title: 'æµ‹è¯•æ¡£æ¡ˆ',
      content: 'æ¡£æ¡ˆå†…å®¹'
    })

    // éªŒè¯æˆåŠŸå›è°ƒ
    expect(onSuccess).toHaveBeenCalled()
  })

  it('åº”è¯¥å¤„ç†æäº¤å¤±è´¥', async () => {
    const mockCreate = vi.fn().mockRejectedValue(new Error('åˆ›å»ºå¤±è´¥'))
    vi.mocked(archiveApi.createArchive).mockImplementation(mockCreate)

    const wrapper = mountWithPlugins(ArchiveForm, {
      props: {
        visible: true
      }
    })

    // å¡«å†™å¹¶æäº¤
    await setInputValue(wrapper, 'input[placeholder="è¯·è¾“å…¥æ¡£æ¡ˆæ ‡é¢˜"]', 'æµ‹è¯•æ¡£æ¡ˆ')
    await clickButton(wrapper, '.submit-btn')
    await flushPromises()

    // åº”è¯¥æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
    expect(wrapper.text()).toContain('åˆ›å»ºå¤±è´¥')
  })

  it('åº”è¯¥æ”¯æŒç¼–è¾‘æ¨¡å¼', async () => {
    const mockUpdate = vi.fn().mockResolvedValue({ id: 1 })
    vi.mocked(archiveApi.updateArchive).mockImplementation(mockUpdate)

    const wrapper = mountWithPlugins(ArchiveForm, {
      props: {
        visible: true,
        mode: 'edit',
        data: {
          id: 1,
          title: 'åŸæ ‡é¢˜',
          content: 'åŸå†…å®¹'
        }
      }
    })

    // éªŒè¯è¡¨å•å·²å¡«å……æ•°æ®
    expect(wrapper.find('input[placeholder="è¯·è¾“å…¥æ¡£æ¡ˆæ ‡é¢˜"]').element.value).toBe('åŸæ ‡é¢˜')

    // ä¿®æ”¹æ ‡é¢˜
    await setInputValue(wrapper, 'input[placeholder="è¯·è¾“å…¥æ¡£æ¡ˆæ ‡é¢˜"]', 'æ–°æ ‡é¢˜')
    await clickButton(wrapper, '.submit-btn')
    await flushPromises()

    // éªŒè¯è°ƒç”¨æ›´æ–°API
    expect(mockUpdate).toHaveBeenCalledWith(1, {
      title: 'æ–°æ ‡é¢˜',
      content: 'åŸå†…å®¹'
    })
  })
})
```

### 4.6 Composableæµ‹è¯•

**ç¤ºä¾‹ - usePermission**ï¼š

```typescript
import { describe, it, expect, beforeEach } from 'vitest'
import { setActivePinia, createPinia } from 'pinia'
import { usePermission } from '@/composables/usePermission'
import { useUserStore } from '@/stores/user'

describe('usePermission', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
  })

  it('åº”è¯¥æ­£ç¡®æ£€æŸ¥æƒé™', () => {
    const userStore = useUserStore()
    userStore.setUser({
      id: 1,
      username: 'testuser',
      permissions: ['archive:read', 'archive:create']
    })

    const { hasPermission } = usePermission()

    expect(hasPermission('archive:read')).toBe(true)
    expect(hasPermission('archive:create')).toBe(true)
    expect(hasPermission('archive:delete')).toBe(false)
  })

  it('åº”è¯¥æ”¯æŒå¤šæƒé™æ£€æŸ¥ï¼ˆANDï¼‰', () => {
    const userStore = useUserStore()
    userStore.setUser({
      id: 1,
      username: 'testuser',
      permissions: ['archive:read', 'archive:create']
    })

    const { hasAllPermissions } = usePermission()

    expect(hasAllPermissions(['archive:read', 'archive:create'])).toBe(true)
    expect(hasAllPermissions(['archive:read', 'archive:delete'])).toBe(false)
  })

  it('åº”è¯¥æ”¯æŒå¤šæƒé™æ£€æŸ¥ï¼ˆORï¼‰', () => {
    const userStore = useUserStore()
    userStore.setUser({
      id: 1,
      username: 'testuser',
      permissions: ['archive:read']
    })

    const { hasAnyPermission } = usePermission()

    expect(hasAnyPermission(['archive:read', 'archive:delete'])).toBe(true)
    expect(hasAnyPermission(['archive:create', 'archive:delete'])).toBe(false)
  })
})
```

### 4.7 æµ‹è¯•é…ç½®

#### 4.7.1 vitest.config.ts

```typescript
import { defineConfig, mergeConfig } from 'vite'
import { configDefaults } from 'vitest/config'
import viteConfig from './vite.config'

export default mergeConfig(
  viteConfig,
  defineConfig({
    test: {
      environment: 'happy-dom',
      globals: true,
      include: ['src/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
      exclude: [...configDefaults.exclude, 'e2e/*'],
      coverage: {
        provider: 'v8',
        reporter: ['text', 'json', 'html', 'lcov'],
        reportsDirectory: './coverage',
        exclude: [
          ...configDefaults.exclude,
          'src/main.ts',
          'src/**/*.d.ts',
          'src/**/*.config.*',
          'src/router/index.ts'
        ],
        thresholds: {
          lines: 70,
          functions: 70,
          branches: 70,
          statements: 70
        }
      },
      testTimeout: 10000,
      hookTimeout: 10000
    }
  })
)
```

---

## æµ‹è¯•ç¼–å†™æŒ‡å—

### 5.1 æµ‹è¯•ç»“æ„ - AAAæ¨¡å¼

æ‰€æœ‰æµ‹è¯•éƒ½åº”éµå¾ª **Arrange-Act-Assert (AAA)** æ¨¡å¼ï¼š

```java
@Test
void testMethodName() {
    // Arrange (Given): å‡†å¤‡æµ‹è¯•æ•°æ®å’Œç¯å¢ƒ
    User user = createTestUser("testuser");
    when(userRepository.findById(1L)).thenReturn(Optional.of(user));
    
    // Act (When): æ‰§è¡Œè¢«æµ‹è¯•çš„æ–¹æ³•
    User result = userService.getUserById(1L);
    
    // Assert (Then): éªŒè¯ç»“æœ
    assertThat(result).isNotNull();
    assertThat(result.getUsername()).isEqualTo("testuser");
}
```

### 5.2 æµ‹è¯•å‘½åè§„èŒƒ

#### 5.2.1 åç«¯æµ‹è¯•å‘½å

**æ ¼å¼**: `methodName_scenario_expectedBehavior`

**ç¤ºä¾‹**ï¼š
```java
// âœ… å¥½çš„å‘½å
createArchive_ValidData_ShouldReturnSavedArchive()
createArchive_EmptyTitle_ShouldThrowValidationException()
deleteArchive_NoPermission_ShouldThrowPermissionDeniedException()

// âŒ ä¸å¥½çš„å‘½å
testCreate()
test1()
createArchiveTest()
```

#### 5.2.2 å‰ç«¯æµ‹è¯•å‘½å

**æ ¼å¼**: ä½¿ç”¨ä¸­æ–‡æè¿°ï¼Œæ¸…æ™°è¡¨è¾¾æµ‹è¯•æ„å›¾

**ç¤ºä¾‹**ï¼š
```typescript
// âœ… å¥½çš„å‘½å
it('åº”è¯¥æ­£ç¡®æ¸²æŸ“è¡¨æ ¼æ•°æ®')
it('åº”è¯¥åœ¨æ ‡é¢˜ä¸ºç©ºæ—¶æ˜¾ç¤ºéªŒè¯é”™è¯¯')
it('åº”è¯¥æˆåŠŸæäº¤è¡¨å•å¹¶è°ƒç”¨API')

// âŒ ä¸å¥½çš„å‘½å
it('test1')
it('renders')
it('works')
```

### 5.3 æ–­è¨€æœ€ä½³å®è·µ

#### 5.3.1 åç«¯æ–­è¨€

**ä½¿ç”¨AssertJæµå¼æ–­è¨€**ï¼š

```java
// âœ… æ¨èï¼šä½¿ç”¨AssertJ
assertThat(result).isNotNull();
assertThat(result.getId()).isEqualTo(1L);
assertThat(result.getTitle()).isEqualTo("æµ‹è¯•æ¡£æ¡ˆ");
assertThat(result.getStatus()).isIn(ArchiveStatus.DRAFT, ArchiveStatus.PUBLISHED);

// âœ… æ¨èï¼šé“¾å¼æ–­è¨€
assertThat(result)
    .isNotNull()
    .extracting(Archive::getTitle, Archive::getStatus)
    .containsExactly("æµ‹è¯•æ¡£æ¡ˆ", ArchiveStatus.DRAFT);

// âŒ ä¸æ¨èï¼šä½¿ç”¨JUnitæ–­è¨€
assertEquals(1L, result.getId());
assertTrue(result.getTitle().equals("æµ‹è¯•æ¡£æ¡ˆ"));
```

**é›†åˆæ–­è¨€**ï¼š

```java
List<Archive> archives = archiveService.findAll();

assertThat(archives)
    .isNotEmpty()
    .hasSize(3)
    .extracting(Archive::getTitle)
    .containsExactlyInAnyOrder("æ¡£æ¡ˆ1", "æ¡£æ¡ˆ2", "æ¡£æ¡ˆ3");
```

**å¼‚å¸¸æ–­è¨€**ï¼š

```java
// âœ… æ¨èï¼šä½¿ç”¨assertThatThrownBy
assertThatThrownBy(() -> archiveService.create(null))
    .isInstanceOf(ValidationException.class)
    .hasMessageContaining("æ ‡é¢˜ä¸èƒ½ä¸ºç©º");

// âŒ ä¸æ¨èï¼šä½¿ç”¨@Test(expected)
@Test(expected = ValidationException.class)
void testCreate() {
    archiveService.create(null);
}
```

#### 5.3.2 å‰ç«¯æ–­è¨€

```typescript
// âœ… åŸºæœ¬æ–­è¨€
expect(result).toBe(expected)
expect(result).toEqual(expected)
expect(result).toBeTruthy()
expect(result).toBeFalsy()

// âœ… æ•°ç»„æ–­è¨€
expect(array).toHaveLength(3)
expect(array).toContain(item)
expect(array).toEqual(expect.arrayContaining([1, 2, 3]))

// âœ… å¯¹è±¡æ–­è¨€
expect(obj).toHaveProperty('name', 'test')
expect(obj).toMatchObject({ name: 'test', age: 25 })

// âœ… DOMæ–­è¨€
expect(wrapper.find('.title').text()).toBe('æµ‹è¯•æ ‡é¢˜')
expect(wrapper.find('.button').exists()).toBe(true)
expect(wrapper.classes()).toContain('active')
```

### 5.4 Mockä½¿ç”¨æŒ‡å—

#### 5.4.1 åç«¯Mock

**Serviceå±‚Mock Repository**ï¼š

```java
@MockBean
private ArchiveRepository archiveRepository;

@Test
void testFindById() {
    // Given
    Archive archive = createTestArchive("æµ‹è¯•æ¡£æ¡ˆ");
    when(archiveRepository.findById(1L)).thenReturn(Optional.of(archive));
    
    // When
    Archive result = archiveService.findById(1L);
    
    // Then
    assertThat(result).isEqualTo(archive);
    verify(archiveRepository, times(1)).findById(1L);
}
```

**Mocké™æ€æ–¹æ³•**ï¼š

```java
@Test
void testWithStaticMethod() {
    try (MockedStatic<DateUtil> mockedStatic = mockStatic(DateUtil.class)) {
        mockedStatic.when(() -> DateUtil.now()).thenReturn(LocalDateTime.of(2024, 1, 1, 0, 0));
        
        // æµ‹è¯•é€»è¾‘
        LocalDateTime result = DateUtil.now();
        assertThat(result).isEqualTo(LocalDateTime.of(2024, 1, 1, 0, 0));
    }
}
```

#### 5.4.2 å‰ç«¯Mock

**Mock APIè°ƒç”¨**ï¼š

```typescript
import { vi } from 'vitest'
import * as archiveApi from '@/api/modules/archive'

vi.mock('@/api/modules/archive')

it('åº”è¯¥è°ƒç”¨APIåˆ›å»ºæ¡£æ¡ˆ', async () => {
  const mockCreate = vi.fn().mockResolvedValue({ id: 1 })
  vi.mocked(archiveApi.createArchive).mockImplementation(mockCreate)
  
  await archiveService.create({ title: 'æµ‹è¯•' })
  
  expect(mockCreate).toHaveBeenCalledWith({ title: 'æµ‹è¯•' })
})
```

**Mock localStorage**ï¼š

```typescript
import { mockLocalStorage } from '@/test-utils/mocks'

it('åº”è¯¥ä¿å­˜æ•°æ®åˆ°localStorage', () => {
  const storage = mockLocalStorage()
  Object.defineProperty(window, 'localStorage', { value: storage })
  
  // æµ‹è¯•é€»è¾‘
  localStorage.setItem('token', 'abc123')
  
  expect(storage.setItem).toHaveBeenCalledWith('token', 'abc123')
})
```

### 5.5 æµ‹è¯•æ•°æ®å‡†å¤‡

#### 5.5.1 ä½¿ç”¨æµ‹è¯•æ•°æ®å·¥å‚

**åç«¯**ï¼š

```java
public class TestDataFactory {
    
    public static User createUser(String username) {
        return User.builder()
            .username(username)
            .password("password123")
            .email(username + "@test.com")
            .status(UserStatus.ACTIVE)
            .build();
    }
    
    public static Archive createArchive(String title, User creator) {
        return Archive.builder()
            .title(title)
            .content("æµ‹è¯•å†…å®¹")
            .categoryId(1L)
            .creator(creator)
            .status(ArchiveStatus.DRAFT)
            .build();
    }
}
```

**å‰ç«¯**ï¼š

```typescript
// test-utils/factories.ts
export function createMockUser(overrides = {}) {
  return {
    id: 1,
    username: 'testuser',
    email: 'test@example.com',
    roles: ['USER'],
    ...overrides
  }
}

export function createMockArchive(overrides = {}) {
  return {
    id: 1,
    title: 'æµ‹è¯•æ¡£æ¡ˆ',
    content: 'æµ‹è¯•å†…å®¹',
    categoryId: 1,
    status: 'DRAFT',
    ...overrides
  }
}
```

---

## æœ€ä½³å®è·µ

### 6.1 æµ‹è¯•ç‹¬ç«‹æ€§

âœ… **æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œ**ï¼š

```java
// âœ… å¥½çš„åšæ³•ï¼šæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹å‡†å¤‡æ•°æ®
@Test
void test1() {
    User user = createTestUser("user1");
    // æµ‹è¯•é€»è¾‘
}

@Test
void test2() {
    User user = createTestUser("user2");
    // æµ‹è¯•é€»è¾‘
}

// âŒ ä¸å¥½çš„åšæ³•ï¼šæµ‹è¯•ä¹‹é—´å…±äº«çŠ¶æ€
private User sharedUser;

@BeforeEach
void setup() {
    sharedUser = createTestUser("shared");
}

@Test
void test1() {
    sharedUser.setName("Modified");  // å½±å“å…¶ä»–æµ‹è¯•
}
```

### 6.2 æµ‹è¯•å¯è¯»æ€§

âœ… **ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡åå’Œæ³¨é‡Š**ï¼š

```java
// âœ… å¥½çš„åšæ³•
@Test
void createArchive_WhenUserHasPermission_ShouldSucceed() {
    // Given: å‡†å¤‡æœ‰æƒé™çš„ç”¨æˆ·å’Œæ¡£æ¡ˆæ•°æ®
    User authorizedUser = createUserWithPermission("archive:create");
    ArchiveCreateDTO validArchiveData = createValidArchiveDTO();
    
    // When: æ‰§è¡Œåˆ›å»ºæ“ä½œ
    Archive result = archiveService.create(validArchiveData, authorizedUser);
    
    // Then: éªŒè¯æ¡£æ¡ˆåˆ›å»ºæˆåŠŸ
    assertThat(result.getId()).isNotNull();
    assertThat(result.getCreator()).isEqualTo(authorizedUser);
}

// âŒ ä¸å¥½çš„åšæ³•
@Test
void test1() {
    User u = new User();
    Archive a = new Archive();
    Archive r = service.create(a, u);
    assertNotNull(r);
}
```

### 6.3 é¿å…æµ‹è¯•è„†å¼±æ€§

âœ… **ä¸è¦ä¾èµ–æ‰§è¡Œé¡ºåº**ï¼š

```java
// âŒ ä¸å¥½çš„åšæ³•ï¼šä¾èµ–æµ‹è¯•æ‰§è¡Œé¡ºåº
@Test
@Order(1)
void createUser() {
    userService.create(user);
}

@Test
@Order(2)
void updateUser() {
    userService.update(user);  // ä¾èµ–test1
}

// âœ… å¥½çš„åšæ³•ï¼šæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹
@Test
void updateUser() {
    User user = userService.create(createTestUser());
    user.setName("Updated");
    userService.update(user);
}
```

### 6.4 æµ‹è¯•è¦†ç›–å…³é”®è·¯å¾„

âœ… **ä¼˜å…ˆæµ‹è¯•æ ¸å¿ƒä¸šåŠ¡é€»è¾‘**ï¼š

```java
// âœ… å¿…é¡»æµ‹è¯•çš„åœºæ™¯
@Test void createArchive_ValidData_Success() { }
@Test void createArchive_EmptyTitle_ThrowsException() { }
@Test void createArchive_NoPermission_ThrowsException() { }
@Test void createArchive_DuplicateTitle_ThrowsException() { }

// å¯é€‰æµ‹è¯•çš„åœºæ™¯
@Test void createArchive_VeryLongTitle_Success() { }
@Test void createArchive_SpecialCharacters_Success() { }
```

### 6.5 åˆç†ä½¿ç”¨å‚æ•°åŒ–æµ‹è¯•

âœ… **å‡å°‘é‡å¤ä»£ç **ï¼š

```java
// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨å‚æ•°åŒ–æµ‹è¯•
@ParameterizedTest
@CsvSource({
    "2024-01-15, yyyy-MM-dd, 2024-01-15",
    "2024/01/15, yyyy/MM/dd, 2024-01-15",
    "20240115, yyyyMMdd, 2024-01-15"
})
void parseDate_VariousFormats(String input, String pattern, String expected) {
    LocalDate result = DateUtil.parse(input, pattern);
    assertThat(result.toString()).isEqualTo(expected);
}

// âŒ ä¸å¥½çš„åšæ³•ï¼šé‡å¤çš„æµ‹è¯•
@Test void parseDate_Format1() { }
@Test void parseDate_Format2() { }
@Test void parseDate_Format3() { }
```

### 6.6 æµ‹è¯•æ€§èƒ½è€ƒè™‘

âœ… **é¿å…ä¸å¿…è¦çš„ç­‰å¾…**ï¼š

```typescript
// âŒ ä¸å¥½çš„åšæ³•ï¼šä½¿ç”¨å›ºå®šå»¶è¿Ÿ
await new Promise(resolve => setTimeout(resolve, 1000))

// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨flushPromises
await flushPromises()

// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨vi.useFakeTimers
vi.useFakeTimers()
// æµ‹è¯•é€»è¾‘
vi.advanceTimersByTime(1000)
vi.useRealTimers()
```

---

## ä»£ç è¦†ç›–ç‡è¦æ±‚

### 7.1 è¦†ç›–ç‡ç›®æ ‡

| æ¨¡å— | è¡Œè¦†ç›–ç‡ | åˆ†æ”¯è¦†ç›–ç‡ | å‡½æ•°è¦†ç›–ç‡ | æˆªæ­¢æ—¶é—´ |
|------|---------|-----------|-----------|----------|
| åç«¯æ ¸å¿ƒä¸šåŠ¡ | â‰¥85% | â‰¥80% | â‰¥85% | ç¬¬5å‘¨æœ« |
| åç«¯å·¥å…·ç±» | â‰¥90% | â‰¥85% | â‰¥90% | ç¬¬4å‘¨æœ« |
| å‰ç«¯æ ¸å¿ƒç»„ä»¶ | â‰¥75% | â‰¥70% | â‰¥75% | ç¬¬5å‘¨æœ« |
| å‰ç«¯å·¥å…·å‡½æ•° | â‰¥85% | â‰¥80% | â‰¥85% | ç¬¬4å‘¨æœ« |

### 7.2 è¦†ç›–ç‡æ’é™¤é¡¹

**åç«¯æ’é™¤**ï¼š
- é…ç½®ç±» (`*Config.java`)
- å®ä½“ç±» (`entity/*.java`)
- DTOç±» (`dto/*.java`)
- å¸¸é‡ç±» (`*Constants.java`)
- å¯åŠ¨ç±» (`*Application.java`)

**å‰ç«¯æ’é™¤**ï¼š
- é…ç½®æ–‡ä»¶ (`*.config.ts`)
- ç±»å‹å®šä¹‰ (`*.d.ts`)
- è·¯ç”±é…ç½® (`router/index.ts`)
- ä¸»å…¥å£ (`main.ts`)

### 7.3 è¦†ç›–ç‡æŠ¥å‘ŠæŸ¥çœ‹

**åç«¯**ï¼š
```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
mvn clean test

# æŸ¥çœ‹HTMLæŠ¥å‘Š
open target/site/jacoco/index.html
```

**å‰ç«¯**ï¼š
```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# æŸ¥çœ‹HTMLæŠ¥å‘Š
open coverage/index.html
```

---

## æµ‹è¯•å‘½åè§„èŒƒ

### 8.1 æµ‹è¯•ç±»å‘½å

**åç«¯**ï¼š
```java
// å•å…ƒæµ‹è¯•
ArchiveServiceTest
UserServiceTest
DateUtilTest

// é›†æˆæµ‹è¯•
ArchiveControllerTest
ArchiveRepositoryTest
ArchiveIntegrationTest
```

**å‰ç«¯**ï¼š
```typescript
// æ–‡ä»¶å‘½å
formatter.spec.ts
user.spec.ts
DataTable.spec.ts
```

### 8.2 æµ‹è¯•æ–¹æ³•å‘½å

**åç«¯ - ä½¿ç”¨@DisplayName**ï¼š
```java
@Test
@DisplayName("åˆ›å»ºæ¡£æ¡ˆ - æˆåŠŸåœºæ™¯")
void createArchive_Success() { }

@Test
@DisplayName("åˆ›å»ºæ¡£æ¡ˆ - æ ‡é¢˜ä¸ºç©ºåº”æŠ›å‡ºå¼‚å¸¸")
void createArchive_EmptyTitle_ShouldThrowException() { }
```

**å‰ç«¯ - ä½¿ç”¨ä¸­æ–‡æè¿°**ï¼š
```typescript
describe('æ¡£æ¡ˆè¡¨å•', () => {
  it('åº”è¯¥æ­£ç¡®æ¸²æŸ“è¡¨å•')
  it('åº”è¯¥éªŒè¯å¿…å¡«å­—æ®µ')
  it('åº”è¯¥æˆåŠŸæäº¤è¡¨å•')
})
```

---

## Mockä¸Stubä½¿ç”¨æŒ‡å—

### 9.1 ä½•æ—¶ä½¿ç”¨Mock

âœ… **åº”è¯¥Mockçš„åœºæ™¯**ï¼š
- å¤–éƒ¨APIè°ƒç”¨
- æ•°æ®åº“æ“ä½œï¼ˆåœ¨å•å…ƒæµ‹è¯•ä¸­ï¼‰
- æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- ç½‘ç»œè¯·æ±‚
- ç¬¬ä¸‰æ–¹æœåŠ¡
- æ—¶é—´ç›¸å…³æ“ä½œ

âŒ **ä¸åº”è¯¥Mockçš„åœºæ™¯**ï¼š
- è¢«æµ‹è¯•çš„ç±»æœ¬èº«
- ç®€å•çš„POJOå¯¹è±¡
- å·¥å…·ç±»ï¼ˆåº”è¯¥æµ‹è¯•çœŸå®å®ç°ï¼‰

### 9.2 Mock vs Stub

**Mock**: éªŒè¯äº¤äº’ï¼ˆæ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨ï¼‰
```java
verify(mockRepository, times(1)).save(any());
```

**Stub**: æä¾›é¢„å®šä¹‰çš„è¿”å›å€¼
```java
when(mockRepository.findById(1L)).thenReturn(Optional.of(archive));
```

---

## CI/CDé›†æˆ

### 10.1 GitHub Actionsé…ç½®

è¯¦è§ä»»åŠ¡1.4çš„CI/CDé…ç½®éƒ¨åˆ†ã€‚

### 10.2 æµ‹è¯•å¤±è´¥å¤„ç†

1. **æœ¬åœ°è¿è¡Œæµ‹è¯•**ï¼šç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
2. **æŸ¥çœ‹CIæ—¥å¿—**ï¼šå®šä½å¤±è´¥åŸå› 
3. **ä¿®å¤é—®é¢˜**ï¼šä¿®å¤ä»£ç æˆ–æµ‹è¯•
4. **é‡æ–°æäº¤**ï¼šè§¦å‘CIé‡æ–°è¿è¡Œ

---

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 11.1 åç«¯å¸¸è§é—®é¢˜

#### Q1: H2æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
# application-test.yml
spring:
  datasource:
    url: jdbc:h2:mem:testdb;MODE=MySQL;DB_CLOSE_DELAY=-1
  jpa:
    hibernate:
      ddl-auto: create-drop
```

#### Q2: æµ‹è¯•ä¹‹é—´ç›¸äº’å½±å“
**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨`@Transactional`è‡ªåŠ¨å›æ»š
- åœ¨`@AfterEach`ä¸­æ¸…ç†æ•°æ®
- ç¡®ä¿æµ‹è¯•ç‹¬ç«‹æ€§

#### Q3: Mockä¸ç”Ÿæ•ˆ
**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// ç¡®ä¿ä½¿ç”¨@MockBeanè€Œä¸æ˜¯@Mock
@MockBean
private UserRepository userRepository;

// ç¡®ä¿when-thenåœ¨æµ‹è¯•æ–¹æ³•å†…éƒ¨
@Test
void test() {
    when(userRepository.findById(1L)).thenReturn(...);
    // æµ‹è¯•é€»è¾‘
}
```

### 11.2 å‰ç«¯å¸¸è§é—®é¢˜

#### Q1: ç»„ä»¶æ‰¾ä¸åˆ°
**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// ä½¿ç”¨mountWithPluginsè‡ªåŠ¨æ³¨å†Œæ’ä»¶
const wrapper = mountWithPlugins(MyComponent)

// æˆ–æ‰‹åŠ¨æ³¨å†Œ
const wrapper = mount(MyComponent, {
  global: {
    plugins: [ElementPlus]
  }
})
```

#### Q2: å¼‚æ­¥æµ‹è¯•ä¸ç¨³å®š
**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// ä½¿ç”¨flushPromisesç­‰å¾…å¼‚æ­¥æ“ä½œ
await clickButton(wrapper, '.submit-btn')
await flushPromises()

// æˆ–ä½¿ç”¨waitFor
await waitFor(() => {
  expect(wrapper.text()).toContain('æˆåŠŸ')
})
```

#### Q3: Mockä¸ç”Ÿæ•ˆ
**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// ç¡®ä¿åœ¨æµ‹è¯•æ–‡ä»¶é¡¶éƒ¨mock
vi.mock('@/api/modules/archive')

// åœ¨æµ‹è¯•ä¸­å®ç°mock
vi.mocked(archiveApi.createArchive).mockResolvedValue({ id: 1 })
```

---

## é™„å½•

### é™„å½•A: æµ‹è¯•æ£€æŸ¥æ¸…å•

**æäº¤ä»£ç å‰æ£€æŸ¥**ï¼š
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ–°å¢ä»£ç æœ‰å¯¹åº”æµ‹è¯•
- [ ] è¦†ç›–ç‡è¾¾æ ‡
- [ ] æµ‹è¯•å‘½åè§„èŒƒ
- [ ] æ— é‡å¤æµ‹è¯•
- [ ] æµ‹è¯•ç‹¬ç«‹è¿è¡Œ
- [ ] Mockä½¿ç”¨åˆç†
- [ ] æ–­è¨€æ¸…æ™°æ˜ç¡®

### é™„å½•B: å¸¸ç”¨å‘½ä»¤

**åç«¯**ï¼š
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn clean test

# è¿è¡ŒæŒ‡å®šæµ‹è¯•ç±»
mvn test -Dtest=ArchiveServiceTest

# è¿è¡ŒæŒ‡å®šæµ‹è¯•æ–¹æ³•
mvn test -Dtest=ArchiveServiceTest#createArchive_Success

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
mvn clean test jacoco:report

# è·³è¿‡æµ‹è¯•
mvn clean install -DskipTests
```

**å‰ç«¯**ï¼š
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test

# ç›‘å¬æ¨¡å¼
npm run test:watch

# UIæ¨¡å¼
npm run test:ui

# ç”Ÿæˆè¦†ç›–ç‡
npm run test:coverage

# è¿è¡ŒæŒ‡å®šæ–‡ä»¶
npm run test formatter.spec.ts
```

### é™„å½•C: å‚è€ƒèµ„æº

**åç«¯**ï¼š
- [JUnit 5 å®˜æ–¹æ–‡æ¡£](https://junit.org/junit5/docs/current/user-guide/)
- [Mockito å®˜æ–¹æ–‡æ¡£](https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mockito.html)
- [AssertJ å®˜æ–¹æ–‡æ¡£](https://assertj.github.io/doc/)
- [Spring Boot Testing](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.testing)

**å‰ç«¯**ï¼š
- [Vitest å®˜æ–¹æ–‡æ¡£](https://vitest.dev/)
- [Vue Test Utils å®˜æ–¹æ–‡æ¡£](https://test-utils.vuejs.org/)
- [Testing Library](https://testing-library.com/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ15æ—¥  
**ç»´æŠ¤äºº**: å¼€å‘å›¢é˜Ÿ  
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸

