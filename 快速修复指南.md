# 快速修复指南 - 档案管理系统

> 🚀 **快速上手**：本文档提供最常用的修复命令和步骤

---

## 📋 当前状态

- ✅ **已修复**：6 类关键错误
- ⏳ **待修复**：约 393 个编译错误
- 🎯 **下一步**：修复 SystemConfigMapper 方法缺失

---

## 🔥 立即执行的 3 个步骤

### 步骤 1：添加 SystemConfigMapper 方法（30 分钟）

打开文件：`src/main/java/com/archive/management/mapper/SystemConfigMapper.java`

在接口中添加以下方法：

```java
/**
 * 根据分组查询配置
 */
@Select("SELECT * FROM sys_config WHERE config_group = #{group} AND deleted = 0")
List<SystemConfig> selectByGroup(@Param("group") String group);

/**
 * 根据键查询配置
 */
@Select("SELECT * FROM sys_config WHERE config_key = #{key} AND deleted = 0")
SystemConfig selectByKey(@Param("key") String key);

/**
 * 根据条件分页查询
 */
@Select("<script>" +
        "SELECT * FROM sys_config WHERE deleted = 0 " +
        "<if test='params.configKey != null'> AND config_key LIKE CONCAT('%', #{params.configKey}, '%') </if>" +
        "<if test='params.configGroup != null'> AND config_group = #{params.configGroup} </if>" +
        "<if test='params.isSystem != null'> AND is_system = #{params.isSystem} </if>" +
        "<if test='params.status != null'> AND status = #{params.status} </if>" +
        "ORDER BY create_time DESC " +
        "LIMIT #{offset}, #{limit}" +
        "</script>")
List<SystemConfig> selectByParams(@Param("params") Map<String, Object> params, 
                                   @Param("offset") int offset, 
                                   @Param("limit") int limit);

/**
 * 根据条件统计数量
 */
@Select("<script>" +
        "SELECT COUNT(*) FROM sys_config WHERE deleted = 0 " +
        "<if test='configKey != null'> AND config_key LIKE CONCAT('%', #{configKey}, '%') </if>" +
        "<if test='configGroup != null'> AND config_group = #{configGroup} </if>" +
        "<if test='isSystem != null'> AND is_system = #{isSystem} </if>" +
        "<if test='status != null'> AND status = #{status} </if>" +
        "</script>")
long countByParams(Map<String, Object> params);
```

### 步骤 2：修复类型转换错误（10 分钟）

查看 `SystemServiceImpl.java` 第 499 行和第 540 行，修复 String 转 Integer 的问题。

可能的修复：
```java
// 如果是 Permission 的 type 字段
permission.setType(Integer.parseInt(request.getType()));
```

### 步骤 3：删除重复方法（10 分钟）

打开 `PerformanceMonitoringController.java`，删除以下重复方法：
- `getDetailedMetrics()` - 第 178 行
- `getPerformanceReport(String)` - 第 191 行
- `getOptimizationSuggestions()` - 第 206 行
- `recordRequestPerformance(long)` - 第 219 行

---

## 🛠️ 常用命令

### 编译命令
```bash
# 清理并编译
./mvnw clean compile -DskipTests

# 查看错误数量
./mvnw compile -DskipTests 2>&1 | grep "ERROR" | wc -l

# 查看特定文件错误
./mvnw compile -DskipTests 2>&1 | grep "SystemServiceImpl" -A 2

# 启动应用
./mvnw spring-boot:run
```

### Git 命令
```bash
# 查看修改
git status

# 提交修改
git add .
git commit -m "fix: 修复编译错误"

# 创建备份分支
git checkout -b backup-before-fix
```

---

## 📊 错误优先级

| 优先级 | 问题 | 预计时间 |
|--------|------|----------|
| 🔴 P0 | SystemConfigMapper 方法缺失 | 30 分钟 |
| 🔴 P0 | 类型转换错误 | 10 分钟 |
| 🟡 P1 | PerformanceMonitoringController 重复方法 | 10 分钟 |
| 🟡 P1 | StreamExportServiceImpl 符号错误 | 15 分钟 |
| 🟢 P2 | 其他错误 | 60-90 分钟 |

---

## ✅ 已完成的修复

1. ✅ SystemServiceImpl 重复方法定义
2. ✅ SystemService UserResponse 导入
3. ✅ JwtUtil 工具类创建
4. ✅ CryptoUtil 加密方法补充
5. ✅ 配置属性类导入
6. ✅ 时间字段自动填充修复

---

## 🆘 遇到问题？

### 编译失败
```bash
# 清理缓存
./mvnw clean

# 重新下载依赖
./mvnw dependency:purge-local-repository

# 更新 IDE 索引
# IntelliJ IDEA: File → Invalidate Caches / Restart
```

### Lombok 不生效
1. 安装 Lombok 插件
2. 启用注解处理：Settings → Compiler → Annotation Processors
3. 重启 IDE

### MyBatis-Plus 问题
检查 `application.yml` 配置：
```yaml
mybatis-plus:
  global-config:
    db-config:
      logic-delete-field: deleted
```

---

## 📚 相关文档

- 📄 [完整修复报告](./编译错误修复报告.md)
- 📄 [项目完善建议](./项目完善建议报告.md)
- 📄 [AI开发助手规则](./AI开发助手MCP工具使用规则.md)

---

## 💡 提示

- 每完成一个步骤，立即编译验证
- 定期提交代码到 Git
- 遇到新错误，先查看详细报告
- 保持耐心，逐步修复

---

**最后更新**：2024年  
**预计完成时间**：1-2 小时

